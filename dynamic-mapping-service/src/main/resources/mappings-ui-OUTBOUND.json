[
  {
    "id": "1925809",
    "identifier": "f7jkg9",
    "name": "Mapping - 151",
    "publishTopic": "evt/outbound/#",
    "publishTopicSample": "evt/outbound/berlin_01",
    "targetAPI": "EVENT",
    "direction": "OUTBOUND",
    "sourceTemplate": "{\"type\":\"c8y_BusEvent\",\"text\":\"Bus was stopped\",\"time\":\"2022-08-05T00:14:49.389+02:00\",\"bus_event\":\"stop_event\"}",
    "targetTemplate": "{\"deviceId\":\"909090\",\"description\":\"This is a new test event.\",\"time\":\"2022-08-05T00:14:49.389+02:00\",\"eventType\":\"TestEvent\",\"bus_event\":\"stop_event\"}",
    "mappingType": "JSON",
    "substitutions": [
      {
        "pathSource": "_IDENTITY_.c8ySourceId",
        "pathTarget": "_TOPIC_LEVEL_[2]",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "type",
        "pathTarget": "eventType",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "$now()",
        "pathTarget": "time",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "bus_event",
        "pathTarget": "bus_event",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "_IDENTITY_.externalId",
        "pathTarget": "deviceId",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      }
    ],
    "active": false,
    "debug": false,
    "tested": false,
    "supportsMessageContext": false,
    "createNonExistingDevice": false,
    "updateExistingDevice": false,
    "autoAckOperation": true,
    "useExternalId": true,
    "externalIdType": "c8y_Serial",
    "snoopStatus": "NONE",
    "snoopedTemplates": [],
    "filterMapping": "bus_event",
    "qos": "AT_LEAST_ONCE",
    "lastUpdate": 1735161611965,
    "genericDeviceIdentifier": "_IDENTITY_.externalId"
  },
  {
    "id": "6826997",
    "identifier": "cxxlmh",
    "name": "Mapping - 152",
    "publishTopic": "evt/outbound/#",
    "publishTopicSample": "evt/outbound/berlin_01",
    "targetAPI": "OPERATION",
    "direction": "OUTBOUND",
    "sourceTemplate": "{\"bus_opp\":\"New engine restart operation!\"}",
    "targetTemplate": "{\"c8y_Id\":\"909090\",\"decription\":\"dummy operation\",\"type\":\"bus_operation\"}",
    "mappingType": "JSON",
    "substitutions": [
      {
        "pathSource": "_IDENTITY_.c8ySourceId",
        "pathTarget": "c8y_Id",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "bus_opp",
        "pathTarget": "decription",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      },
      {
        "pathSource": "_IDENTITY_.externalId",
        "pathTarget": "_TOPIC_LEVEL_[2]",
        "repairStrategy": "DEFAULT",
        "expandArray": false
      }
    ],
    "active": false,
    "debug": false,
    "tested": false,
    "supportsMessageContext": false,
    "createNonExistingDevice": false,
    "updateExistingDevice": false,
    "autoAckOperation": true,
    "useExternalId": true,
    "externalIdType": "c8y_Serial",
    "snoopStatus": "NONE",
    "snoopedTemplates": [],
    "filterMapping": "bus_opp",
    "qos": "AT_LEAST_ONCE",
    "lastUpdate": 1735162008771,
    "genericDeviceIdentifier": "_IDENTITY_.externalId"
  },
  {
    "id": "5774279",
    "identifier": "bye1yc",
    "name": "Mapping - 155",
    "publishTopic": "measurement/measurements",
    "publishTopicSample": "measurement/measurements",
    "targetAPI": "EVENT",
    "direction": "OUTBOUND",
    "sourceTemplate": "{\"text\":\"This is a new test event.\",\"time\":\"2022-08-05T00:14:49.389+02:00\",\"type\":\"c8y_TestEvent\"}",
    "targetTemplate": "{\"type\":\"c8y_AnyType\"}",
    "mappingType": "CODE_BASED",
    "substitutions": [],
    "active": false,
    "debug": false,
    "tested": false,
    "supportsMessageContext": true,
    "createNonExistingDevice": false,
    "updateExistingDevice": false,
    "autoAckOperation": true,
    "useExternalId": false,
    "externalIdType": "c8y_Serial",
    "snoopStatus": "NONE",
    "snoopedTemplates": [],
    "filterMapping": "$exists(time)",
    "filterInventory": "type = \"wika_PGW23\"",
    "qos": "AT_LEAST_ONCE",
    "code": "LyomJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiMgICAgJiYmICAgCiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYjICAgICYmJiAgIAomJiYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIyAgICAmJiYgICAKJiYmICAgIC4mJiYmJiAgICAgIC4mJiYmJiAgICAgICYmJiYmJiAgICAmJiYmJiAgICAgLiYmJiYvICAgICAuJiYmJiYmICAgICAgICAgICYmJiYmJiYmICAgICAgICAgICAmJiMgICAgJiYmICAgCiYmJiAgICAgJiYmJiYmICAgICAmJiYmJiYmICAgICAmJiYmJiAgICAgJiYmJiYgICAgIC4mJiYmLyAgICYmJiYmJiYgICAgICAgICAgICYmJiYmJiYmJiYgICAgICAgICAgJiYjICAgICYmJiAgIAomJiYgICAgICAmJiYmJiggICAmJiYmJiYmJiMgICAmJiYmJiggICAgICYmJiYmICAgICAuJiYmJi8gJiYmJiYmICAgICAgICAgICAgICYmJiYmIC8mJiYmJiAgICAgICAgICYmIyAgICAmJiYgICAKJiYmICAgICAgICYmJiYmICAvJiYmJiwmJiYmICAsJiYmJiYgICAgICAmJiYmJiAgICAgLiYmJiYmJiYmJiYmICAgICAgICAgICAgICYmJiYmICAgJiYmJiYlICAgICAgICAmJiMgICAgJiYmICAgCiYmJiAgICAgICAlJiYmJiYgJiYmJiAgJiYmJiYgJiYmJiYgICAgICAgJiYmJiYgICAgIC4mJiYmJiYmJiYmJiYmICAgICAgICAgICYmJiYmJSAgICAmJiYmJiggICAgICAgJiYjICAgICYmJiAgIAomJiYgICAgICAgICYmJiYmJiYmJiggICAmJiYmJiYmJiYuICAgICAgICYmJiYmICAgICAuJiYmJiYgICAmJiYmJiYjICAgICAgICYmJiYmJiYmJiYmJiYmJiYmLiAgICAgICYmIyAgICAmJiYgICAKJiYmICAgICAgICAgJiYmJiYmJiYgICAgICYmJiYmJiYmICAgICAgICAmJiYmJiAgICAgLiYmJiYvICAgICAmJiYmJiYgICAgIComJiYmJiAgICAgICAgJiYmJiYgICAgICAmJiMgICAgJiYmICAgCiYmJiAgICAgICAgICAmJiYmJiYgICAgICAvJiYmJiYmICAgICAgICAgJiYmJiYgICAgIC4mJiYmLyAgICAgICAmJiYmJiYgICAmJiYmJiAgICAgICAgICMmJiYmJiAgICAgJiYjICAgICYmJiAgIAomJiYgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiYgICAKJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmICAgCiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYqLwoKLyoqCiAqIEdlbmVyYWwgaW5mb3JtYXRpb246ICAgCiAqIFRoaXMgSmF2YVNjcmlwdC1iYXNlZCBwYXlsb2FkIGZvcm1hdHRlciBpcyBhIHBhcnNlciB0byBkZWNvZGUgZGF0YSBmcm9tIGJ5dGVzIGludG8KICogSlNPTiBPYmplY3QuIEl0IGNhbiBvbmx5IHBhcnNlIHBheWxvYWQgZnJvbSBQR1cyMy4xMDAuMTEgZGV2aWNlcy4gCiAqIFRoaXMgcGFyc2VyIGZvbGxvd3MgdGhlIHNwZWNpZmljYXRpb24gTG9SYVdBTsKuIFBheWxvYWQgQ29kZWMgQVBJIFNwZWNpZmljYXRpb24gVFMwMTMtMS4wLjAuCiAqIAogKiAKICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogQ29weXJpZ2h0IChDKSAyMDIzIFdJS0EgQWxleGFuZGVyIFdpZWdhbmQgU0UgJiBDby4gS0cgICAKICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAogKiAKICogU1BEWC1GaWxlTmFtZTogaW5kZXguanMKICogU1BEWC1QYWNrYWdlVmVyc2lvbjogMi4wLjAKICogIAoqLwoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLy8gUHVibGljIERlY29kaW5nIFNlY3Rpb24KLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCi8qKgogKiBBVFRFTlRJT046IFlvdSBtdXN0IGRlZmluZSB0aGUgbWVhc3VyZW1lbnQgcmFuZ2VzIGZpcnN0LCBvdGhlcndpc2UgdGhlIHNjcmlwdCB3aWxsIG5vdCB3b3JrLgogKiBUaGUgZGV2aWNlIGNvbmZpZ3VyYXRpb24gZGVmaW5lcyB0aGUgbWVhc3VyZW1lbnQgcmFuZ2VzIGZvciB0aGUgc3VwcG9ydGVkIG1lYXN1cmVkIHZhcmlhYmxlcyBvZiB5b3VyIHVzZWQgZGV2aWNlcywgZS5nLgogKiB2YXIgUFJFU1NVUkVfUkFOR0VfU1RBUlQgPSAwOwogKiB2YXIgUFJFU1NVUkVfUkFOR0VfRU5EID0gMTA7CiAqIHZhciBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfU1RBUlQgPSAtNDA7CiAqIHZhciBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfRU5EID0gNjA7IAogKi8KCi8qKgogKiBUaGUgc3RhcnRpbmcgdmFsdWUgb2YgdGhlIHByZXNzdXJlIHJhbmdlLgogKiBAdHlwZSB7bnVtYmVyfQogKi8KdmFyIFBSRVNTVVJFX1JBTkdFX1NUQVJUID0gMDsKCi8qKgogKiBUaGUgZW5kaW5nIHZhbHVlIG9mIHRoZSBwcmVzc3VyZSByYW5nZS4KICogQHR5cGUge251bWJlcn0KICovCnZhciBQUkVTU1VSRV9SQU5HRV9FTkQ9IDEwOwoKLyoqCiAqIFRoZSBzdGFydGluZyB2YWx1ZSBvZiB0aGUgZGV2aWNlIHRlbXBlcmF0dXJlIHJhbmdlLgogKiBAdHlwZSB7bnVtYmVyfQogKi8KdmFyIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCA9IC00MDsKCi8qKgogKiBUaGUgZW5kaW5nIHZhbHVlIG9mIHRoZSBkZXZpY2UgdGVtcGVyYXR1cmUgcmFuZ2UuCiAqIEB0eXBlIHtudW1iZXJ9CiAqLwp2YXIgREVWSUNFX1RFTVBFUkFUVVJFX1JBTkdFX0VORCA9IDYwOwoKCi8qKgogKiBEZWNvZGUgdXBsaW5rIGVudHJ5IHBvaW50CiAqIEB0eXBlZGVmICB7T2JqZWN0fSAgICBpbnB1dCAgICAgICAgICAtIEFuIG9iamVjdCBwcm92aWRlZCBieSB0aGUgSW9UIEZsb3cgZnJhbWV3b3JrCiAqIEBwcm9wZXJ0eSB7bnVtYmVyW119ICBpbnB1dC5ieXRlcyAgICAtIEFycmF5IG9mIGJ5dGVzIHJlcHJlc2VudGVkIGFzIG51bWJlcnMgYXMgaXQgaGFzIGJlZW4gc2VudCBmcm9tIHRoZSBkZXZpY2UKICogQHByb3BlcnR5IHtudW1iZXJ9ICAgIGlucHV0LmZQb3J0ICAgIC0gVGhlIFBvcnQgRmllbGQgb24gd2hpY2ggdGhlIHVwbGluayBoYXMgYmVlbiBzZW50CiAqIEBwcm9wZXJ0eSB7RGF0ZX0gICAgICBpbnB1dC5yZWN2VGltZSAtIFRoZSB1cGxpbmsgbWVzc2FnZSB0aW1lIHJlY29yZGVkIGJ5IHRoZSBMb1JhV0FOIG5ldHdvcmsgc2VydmVyCiAqLwoKLyoqCiAqIERlY29kZWQgdXBsaW5rIGRhdGEKICogQHR5cGVkZWYgIHtPYmplY3R9ICAgICAgICAgICAgICAgb3V0cHV0ICAgICAtIEFuIG9iamVjdCB0byBiZSByZXR1cm5lZCB0byB0aGUgSW9UIEZsb3cgZnJhbWV3b3JrCiAqIEBwcm9wZXJ0eSB7T2JqZWN0LjxzdHJpbmcsICo+fSAgIGRhdGEgICAgICAgLSBUaGUgb3BlbiBKYXZhU2NyaXB0IG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdXBsaW5rIHBheWxvYWQgd2hlbiBubyBlcnJvcnMgb2NjdXJyZWQKICogQHByb3BlcnR5IHtzdHJpbmdbXX0gICAgICAgICAgICAgW2Vycm9yc10gICAtIEEgbGlzdCBvZiBlcnJvciBtZXNzYWdlcyB3aGlsZSBkZWNvZGluZyB0aGUgdXBsaW5rIHBheWxvYWQKICogQHByb3BlcnR5IHtzdHJpbmdbXX0gICAgICAgICAgICAgW3dhcm5pbmdzXSAtIEEgbGlzdCBvZiB3YXJuaW5nIG1lc3NhZ2VzIHRoYXQgZG8gbm90IHByZXZlbnQgdGhlIGRyaXZlciBmcm9tIGRlY29kaW5nIHRoZSB1cGxpbmsgcGF5bG9hZAogKi8KCi8qKgogKiBAdHlwZWRlZiB7T2JqZWN0fSAgRGVjb2RlZFVwbGluayAgLSBBbiBvYmplY3QgdGhhdCByZXByZXNlbnRzIHRoZSBkZWNvZGVkIHVwbGluayBwYXlsb2FkCiAqLwoKLyoqCiAqIFRvIGRlY29kZSB0aGUgdXBsaW5rIGRhdGEgZGVmaW5lZCBieSBMb1JhV0FOCiAqIEBhY2Nlc3MgcHVibGljCiAqIEBwYXJhbSAgIHtpbnB1dH0gICAgIGlucHV0IC0gVGhlIG9iamVjdCB0byBkZWNvZGUKICogQHJldHVybnMge291dHB1dH0gICAgICAgICAgLSBUaGUgZGVjb2RlZCBvYmplY3QKICovCmZ1bmN0aW9uIGRlY29kZVVwbGluayhpbnB1dCkgewogICAgcmV0dXJuIGRlY29kZShpbnB1dCk7Cn0KCi8qKgogKiBUbyBkZWNvZGUgZnJvbSBoZXggZW5jb2RlZCBzdHJpbmcKICogQGFjY2VzcyBwdWJsaWMKICogQHBhcmFtICAge251bWJlcn0gICAgZlBvcnQgICAgICAgICAgICAgLSBUaGUgUG9ydCBGaWVsZCBvbiB3aGljaCB0aGUgdXBsaW5rIGhhcyBiZWVuIHNlbnQKICogQHBhcmFtICAge3N0cmluZ30gICAgaGV4RW5jb2RlZFN0cmluZyAgLSBBIGhleCBlbmNvZGVkIHN0cmluZyBoYXMgYmVlbiBzZW50IGZyb20gdGhlIGRldmljZQogKiBAcmV0dXJucyB7b3V0cHV0fSAgICAgICAgICAgICAgICAgICAgICAtIFRoZSBkZWNvZGVkIG9iamVjdAogKi8KZnVuY3Rpb24gZGVjb2RlSGV4U3RyaW5nKGZQb3J0LCBoZXhFbmNvZGVkU3RyaW5nKSB7CiAgICAvKioKICAgICAqIEB0eXBlIHtpbnB1dH0KICAgICAqLwogICAgdmFyIGlucHV0ID0ge307CiAgICBpbnB1dC5ieXRlcyA9IGNvbnZlcnRIZXhTdHJpbmdUb0J5dGVzKGhleEVuY29kZWRTdHJpbmcpOwogICAgaW5wdXQuZlBvcnQgPSBmUG9ydDsKCiAgICByZXR1cm4gZGVjb2RlKGlucHV0KTsKfQoKLyoqCiAqIFRvIGRlY29kZSBmcm9tIGJhc2U2NCBzdHJpbmcKICogQGFjY2VzcyBwdWJsaWMKICogQHBhcmFtICAge251bWJlcn0gICAgZlBvcnQgICAgICAgICAgICAgICAgICAgLSBUaGUgUG9ydCBGaWVsZCBvbiB3aGljaCB0aGUgdXBsaW5rIGhhcyBiZWVuIHNlbnQKICogQHBhcmFtICAge3N0cmluZ30gICAgYmFzZTY0RW5jb2RlZFN0cmluZyAgICAgLSBBIGJhc2U2NCBlbmNvZGVkIHN0cmluZyBoYXMgYmVlbiBzZW50IGZyb20gdGhlIGRldmljZQogKiBAcmV0dXJucyB7b3V0cHV0fSAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFRoZSBkZWNvZGVkIG9iamVjdAogKi8KZnVuY3Rpb24gZGVjb2RlQmFzZTY0U3RyaW5nKGZQb3J0LCBiYXNlNjRFbmNvZGVkU3RyaW5nKSB7CiAgICAvKioKICAgICAqIEB0eXBlIHtpbnB1dH0KICAgICAqLwogICAgdmFyIGlucHV0ID0ge307CiAgICBpbnB1dC5ieXRlcyA9IGNvbnZlcnRCYXNlNjRTdHJpbmdUb0J5dGVzKGJhc2U2NEVuY29kZWRTdHJpbmcpOwogICAgaW5wdXQuZlBvcnQgPSBmUG9ydDsKCiAgICByZXR1cm4gZGVjb2RlKGlucHV0KTsKfQoKCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8vIFByaXZhdGUgRGVjb2RpbmcgU2VjdGlvbgovLyAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKLyoqCiAqIEdlbmVyaWMgRGF0YSBDaGFubmVsIFZhbHVlcwogKi8KdmFyIERFVklDRV9OQU1FID0gIlBHVzIzLjEwMC4xMSI7Cgp2YXIgR0VORVJJQ19EQVRBX0NIQU5ORUxfUkFOR0VfU1RBUlQgPSAyNTAwOwp2YXIgR0VORVJJQ19EQVRBX0NIQU5ORUxfUkFOR0VfRU5EID0gMTI1MDA7CnZhciBFUlJPUl9WQUxVRSA9IDB4ZmZmZjsKCnZhciBDSEFOTkVMX05BTUVTX0RJQ1RJT05BUlkgPSBbJ3ByZXNzdXJlJywgJ2RldmljZSB0ZW1wZXJhdHVyZScsICdiYXR0ZXJ5IHZvbHRhZ2UnXTsKdmFyIEFMQVJNX0VWRU5UX05BTUVTX0RJQ1RJT05BUlkgPSBbJ3RyaWdnZXJlZCcsICdkaXNhcHBlYXJlZCddOwp2YXIgQUxBUk1fQ0hBTk5FTF9OQU1FU19ESUNUSU9OQVJZID0gWydwcmVzc3VyZScsICdkZXZpY2UgdGVtcGVyYXR1cmUnXTsKdmFyIFBST0NFU1NfQUxBUk1fVFlQRV9OQU1FU19ESUNUSU9OQVJZID0gWydsb3cgdGhyZXNob2xkJywgJ2hpZ2ggdGhyZXNob2xkJywgJ2ZhbGxpbmcgc2xvcGUnLCAncmlzaW5nIHNsb3BlJywgJ2xvdyB0aHJlc2hvbGQgd2l0aCBkZWxheScsICdoaWdoIHRocmVzaG9sZCB3aXRoIGRlbGF5J107CnZhciBURUNITklDQUxfQUxBUk1fQ0FVU0VfT0ZfRkFJTFVSRV9OQU1FU19ESUNUSU9OQVJZID0gWycnLCAnZ2VuZXJhbCBmYWlsdXJlJ107CnZhciBERVZJQ0VfQUxBUk1fQ0FVU0VfT0ZfRkFJTFVSRV9OQU1FU19ESUNUSU9OQVJZID0gWycnLCAnZGV2aWNlIGRlcGVuZGVudCddOwp2YXIgREVWSUNFX0FMQVJNX1RZUEVfTkFNRVNfRElDVElPTkFSWSA9IFsnbG93IHRlbXBlcmF0dXJlIGFsYXJtJ107CgovKioKICogVGhlIHBhZFN0YXJ0KCkgbWV0aG9kIG9mIFN0cmluZyB2YWx1ZXMgcGFkcyB0aGlzIHN0cmluZyB3aXRoIGFub3RoZXIgc3RyaW5nIChtdWx0aXBsZSB0aW1lcywgaWYgbmVlZGVkKSB1bnRpbCB0aGUgcmVzdWx0aW5nIHN0cmluZyByZWFjaGVzIHRoZSBnaXZlbiBsZW5ndGguCiAqIFRoZSBmdW5jdGlvbiBpcyByZWltcGxlbWVudGVkIHRvIHN1cHBvcnQgRVM1LgogKiBAYWNjZXNzIHByaXZhdGUKICogQHBhcmFtICAge251bWJlcn0gICAgIHRhcmdldExlbmd0aCAtIFRoZSBsZW5ndGggb2YgdGhlIHJldHVybmVkIHN0cmluZwogKiBAcGFyYW0gICB7c3RyaW5nfSAgICAgcGFkU3RyaW5nIC0gVGhlIHN0cmluZyB0byBtb2RpZnkKICogQHJldHVybnMge3N0cmluZ30gICAgICAgICAgLSBUaGUgZGVjb2RlZCBvYmplY3QKICovClN0cmluZy5wcm90b3R5cGUucGFkU3RhcnQgPSBmdW5jdGlvbiAodGFyZ2V0TGVuZ3RoLCBwYWRTdHJpbmcpIHsKCiAgICB2YXIgdGVtcFN0cmluZyA9IHRoaXMudmFsdWVPZigpOwoKICAgIGZvcih2YXIgaSA9IHRoaXMubGVuZ3RoOyBpIDwgdGFyZ2V0TGVuZ3RoOyArK2kpCiAgICB7CiAgICAgICAgdGVtcFN0cmluZyA9IHBhZFN0cmluZyArIHRlbXBTdHJpbmc7CiAgICB9CgogICAgcmV0dXJuIHRlbXBTdHJpbmc7IAogfTsKCi8qKgogKiBUbyBkZWNvZGUgdGhlIHVwbGluayBkYXRhCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0gICB7aW5wdXR9ICAgICBpbnB1dCAtIFRoZSBvYmplY3QgdG8gZGVjb2RlCiAqIEByZXR1cm5zIHtvdXRwdXR9ICAgICAgICAgIC0gVGhlIGRlY29kZWQgb2JqZWN0CiAqLwpmdW5jdGlvbiBkZWNvZGUoaW5wdXQpIHsKICAgIC8vIERlZmluZSBvdXRwdXQgb2JqZWN0CgogICAgdmFyIG91dHB1dCA9IGNyZWF0ZU91dHB1dE9iamVjdCgpOwogICAgb3V0cHV0ID0gY2hlY2tNZWFzdXJlbWVudFJhbmdlcyhvdXRwdXQpOwogICAgaWYgKG91dHB1dC5lcnJvcnMpIHsKICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgfQoKICAgIC8qIFNlbGVjdCBzdWJmdW5jdGlvbiB0byBkZWNvZGUgbWVzc2FnZSAqLwogICAgc3dpdGNoIChpbnB1dC5ieXRlc1swXSkgewogICAgICAgIC8qIHVudXNlZCAqLwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgY2FzZSAweDAwOgogICAgICAgIGNhc2UgMHgwNjogLy8gY29uZmlndXJhdGlvbiBzdGF0dXMgbWVzc2FnZSBpcyBub3Qgc3VwcG9ydGVkCiAgICAgICAgY2FzZSAweDA5OiAvLyBleHRlbmRlZCBkZXZpY2UgaWRlbnRpZmljYXRpb24gbWVzc2FnZSBpcyBub3Qgc3VwcG9ydGVkCiAgICAgICAgICAgIC8vIEVycm9yLCBub3QgZW5vdWdoIGJ5dGVzICAgICAgICAgICAgCiAgICAgICAgICAgIG91dHB1dCA9IGFkZEVycm9yTWVzc2FnZShvdXRwdXQsICJEYXRhIG1lc3NhZ2UgdHlwZSAiICsgaW5wdXQuYnl0ZXNbMF0udG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikgKyAiIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIC8qIERhdGEgbWVzc2FnZSAqLwogICAgICAgIGNhc2UgMHgwMToKICAgICAgICBjYXNlIDB4MDI6CiAgICAgICAgICAgIC8qIENoZWNrIGlmIGFsbCBieXRlcyBuZWVkZWQgZm9yIGRlY29kaW5nIGFyZSB0aGVyZSAqLwogICAgICAgICAgICBpZiAoaW5wdXQuYnl0ZXMubGVuZ3RoID09IDcpIHsKICAgICAgICAgICAgICAgIC8vIGRlY29kZQogICAgICAgICAgICAgICAgb3V0cHV0ID0gZGVjb2RlRGF0YU1lc3NhZ2UoaW5wdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gRXJyb3IsIG5vdCBlbm91Z2ggYnl0ZXMKICAgICAgICAgICAgICAgIG91dHB1dCA9IGFkZEVycm9yTWVzc2FnZShvdXRwdXQsICJEYXRhIG1lc3NhZ2UgMDEvMDIgbmVlZHMgNyBieXRlcyBidXQgZ290ICIgKyBpbnB1dC5ieXRlcy5sZW5ndGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAvKiBQcm9jZXNzIGFsYXJtICovCiAgICAgICAgY2FzZSAweDAzOgogICAgICAgICAgICAvKiBDaGVjayBpZiBhbGwgYnl0ZXMgbmVlZGVkIGZvciBkZWNvZGluZyBhcmUgdGhlcmUgYW5kIGFsbCBieXRlcyBmb3IgZWFjaCBhbGFybSAqLwogICAgICAgICAgICBpZiAoaW5wdXQuYnl0ZXMubGVuZ3RoID49IDUgJiYgISgoaW5wdXQuYnl0ZXMubGVuZ3RoIC0gMikgJSAzKSkgewogICAgICAgICAgICAgICAgLy8gZGVjb2RlCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBkZWNvZGVQcm9jZXNzQWxhcm0oaW5wdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gRXJyb3IsIG5vdCBlbm91Z2ggYnl0ZXMKICAgICAgICAgICAgICAgIG91dHB1dCA9IGFkZEVycm9yTWVzc2FnZShvdXRwdXQsICJQcm9jZXNzIGFsYXJtIDAzIG5lZWRzIGF0IGxlYXN0IDUgYnl0ZXMgYW5kIGdvdCAiICsgaW5wdXQuYnl0ZXMubGVuZ3RoICsgIi4gQWxzbyBhbGwgYnl0ZXMgZm9yIGVhY2ggYWxhcm0gbmVlZGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIC8qIFRlY2huaWNhbCBhbGFybSAqLwogICAgICAgIGNhc2UgMHgwNDoKICAgICAgICAgICAgLyogQ2hlY2sgaWYgYWxsIGJ5dGVzIG5lZWRlZCBmb3IgZGVjb2RpbmcgYXJlIHRoZXJlIGFuZCBhbGwgYnl0ZXMgZm9yIGVhY2ggYWxhcm0gKi8KICAgICAgICAgICAgaWYgKGlucHV0LmJ5dGVzLmxlbmd0aCA+PSA1ICYmICEoKGlucHV0LmJ5dGVzLmxlbmd0aCAtIDIpICUgMykpIHsKICAgICAgICAgICAgICAgIC8vIGRlY29kZQogICAgICAgICAgICAgICAgb3V0cHV0ID0gZGVjb2RlVGVjaG5pY2FsQWxhcm0oaW5wdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgLy8gRXJyb3IsIG5vdCBlbm91Z2ggYnl0ZXMKICAgICAgICAgICAgICAgIG91dHB1dCA9IGFkZEVycm9yTWVzc2FnZShvdXRwdXQsICJUZWNobmljYWwgYWxhcm0gMDQgbmVlZHMgNSBieXRlcyBidXQgZ290ICIgKyBpbnB1dC5ieXRlcy5sZW5ndGggKyAiLiBBbHNvIGFsbCBieXRlcyBmb3IgZWFjaCBhbGFybSBuZWVkZWQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgLyogRGV2aWNlIGFsYXJtICovCiAgICAgICAgY2FzZSAweDA1OgogICAgICAgICAgICAvKiBDaGVjayBpZiBhbGwgYnl0ZXMgbmVlZGVkIGZvciBkZWNvZGluZyBhcmUgdGhlcmUgKi8KICAgICAgICAgICAgaWYgKGlucHV0LmJ5dGVzLmxlbmd0aCA9PSA0KSB7CiAgICAgICAgICAgICAgICAvLyBkZWNvZGUKICAgICAgICAgICAgICAgIG91dHB1dCA9IGRlY29kZURldmljZUFsYXJtKGlucHV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEVycm9yLCBub3QgZW5vdWdoIGJ5dGVzCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiRGV2aWNlIGFsYXJtIDA1IG5lZWRzIDQgYnl0ZXMgYnV0IGdvdCAiICsgaW5wdXQuYnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgLyogRGV2aWNlIGlkZW50aWZpY2F0aW9uICovCiAgICAgICAgY2FzZSAweDA3OgogICAgICAgICAgICAvKiBDaGVjayBpZiBhbGwgYnl0ZXMgbmVlZGVkIGZvciBkZWNvZGluZyBhcmUgdGhlcmUgKi8KICAgICAgICAgICAgaWYgKGlucHV0LmJ5dGVzLmxlbmd0aCA9PSA0MSkgewogICAgICAgICAgICAgICAgLy8gZGVjb2RlCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBkZWNvZGVEZXZpY2VJZGVudGlmaWNhdGlvbihpbnB1dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBFcnJvciwgbm90IGVub3VnaCBieXRlcwogICAgICAgICAgICAgICAgb3V0cHV0ID0gYWRkRXJyb3JNZXNzYWdlKG91dHB1dCwgIklkZW50aWZpY2F0aW9uIG1lc3NhZ2UgMDcgbmVlZHMgNDEgYnl0ZXMgYnV0IGdvdCAiICsgaW5wdXQuYnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgLyogS2VlcCBhbGl2ZSAqLwogICAgICAgIGNhc2UgMHgwODoKICAgICAgICAgICAgLyogQ2hlY2sgaWYgYWxsIGJ5dGVzIG5lZWRlZCBmb3IgZGVjb2RpbmcgYXJlIHRoZXJlICovCiAgICAgICAgICAgIGlmIChpbnB1dC5ieXRlcy5sZW5ndGggPT0gMykgewogICAgICAgICAgICAgICAgLy8gRGVjb2RlCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBkZWNvZGVLZWVwQWxpdmVNZXNzYWdlKGlucHV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEVycm9yLCBub3QgZW5vdWdoIGJ5dGVzCiAgICAgICAgICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiS2VlcCBhbGl2ZSBtZXNzYWdlIDA4IG5lZWRzIDMgYnl0ZXMgYnV0IGdvdCAiICsgaW5wdXQuYnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICByZXR1cm4gb3V0cHV0Owp9CgovKioKICogRGVjb2RlcyBhIGRhdGEgbWVzc2FnZSAwMSwgMDIgaW50byBhbiBvYmplY3QKICogQGFjY2VzcyBwcml2YXRlCiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgIGlucHV0ICAgICAgICAgICAtIEFuIG9iamVjdCBwcm92aWRlZCBieSB0aGUgSW9UIEZsb3cgZnJhbWV3b3JrCiAqIEBwYXJhbSB7bnVtYmVyW119ICAgIGlucHV0LmJ5dGVzICAgICAtIEFycmF5IG9mIGJ5dGVzIHJlcHJlc2VudGVkIGFzIG51bWJlcnMgYXMgaXQgaGFzIGJlZW4gc2VudCBmcm9tIHRoZSBkZXZpY2UKICogQHBhcmFtIHtudW1iZXJ9ICAgICAgaW5wdXQuZlBvcnQgICAgIC0gVGhlIFBvcnQgRmllbGQgb24gd2hpY2ggdGhlIHVwbGluayBoYXMgYmVlbiBzZW50CiAqIEBwYXJhbSB7RGF0ZX0gICAgICAgIGlucHV0LnJlY3ZUaW1lICAtIFRoZSB1cGxpbmsgbWVzc2FnZSB0aW1lIHJlY29yZGVkIGJ5IHRoZSBMb1JhV0FOIG5ldHdvcmsgc2VydmVyCiAqIEByZXR1cm5zIHtvdXRwdXR9ICAgICAgICAgICAgIC0gVGhlIGRlY29kZWQgb2JqZWN0CiAqLwpmdW5jdGlvbiBkZWNvZGVEYXRhTWVzc2FnZShpbnB1dCkgewogICAgLy8gT3V0cHV0CiAgICB2YXIgb3V0cHV0ID0gY3JlYXRlT3V0cHV0T2JqZWN0KCk7CgogICAgLy8gZGF0YSBtZXNzYWdlIHR5cGUKICAgIG91dHB1dC5kYXRhLm1lc3NhZ2VUeXBlID0gaW5wdXQuYnl0ZXNbMF07CgogICAgLy8gY3VycmVudCBjb25maWd1cmF0aW9uIGlkCiAgICBvdXRwdXQuZGF0YS5jb25maWd1cmF0aW9uSWQgPSBpbnB1dC5ieXRlc1sxXTsKCiAgICBvdXRwdXQuZGF0YS5tZWFzdXJlbWVudCA9IHt9OwogICAgb3V0cHV0LmRhdGEubWVhc3VyZW1lbnQuY2hhbm5lbHMgPSBbXTsKCiAgICAvLyBwcmVzc3VyZSAtIGNoYW5uZWwgMAogICAgdmFyIHByZXNzdXJlID0ge307CiAgICBwcmVzc3VyZS5jaGFubmVsSWQgPSAwOwogICAgcHJlc3N1cmUuY2hhbm5lbE5hbWUgPSBDSEFOTkVMX05BTUVTX0RJQ1RJT05BUllbcHJlc3N1cmUuY2hhbm5lbElkXTsKICAgIHByZXNzdXJlLnZhbHVlID0gZ2V0Q2FsY3VsYXRlZFByZXNzdXJlKGlucHV0LmJ5dGVzWzNdIDw8IDggfCBpbnB1dC5ieXRlc1s0XSk7CiAgICBvdXRwdXQuZGF0YS5tZWFzdXJlbWVudC5jaGFubmVscy5wdXNoKHByZXNzdXJlKTsKCiAgICAvLyB0ZW1wZXJhdHVyZSAtIGNoYW5uZWwgMQogICAgdmFyIHRlbXBlcmF0dXJlID0ge307CiAgICB0ZW1wZXJhdHVyZS5jaGFubmVsSWQgPSAxOwogICAgdGVtcGVyYXR1cmUuY2hhbm5lbE5hbWUgPSBDSEFOTkVMX05BTUVTX0RJQ1RJT05BUllbdGVtcGVyYXR1cmUuY2hhbm5lbElkXTsKICAgIHRlbXBlcmF0dXJlLnZhbHVlID0gZ2V0Q2FsY3VsYXRlZFRlbXBlcmF0dXJlKGlucHV0LmJ5dGVzWzVdIDw8IDggfCBpbnB1dC5ieXRlc1s2XSk7CiAgICBvdXRwdXQuZGF0YS5tZWFzdXJlbWVudC5jaGFubmVscy5wdXNoKHRlbXBlcmF0dXJlKTsKCiAgICAvLyBiYXR0ZXJ5IHZvbHRhZ2UgLSBjaGFubmVsIHgKICAgIHZhciBiYXR0ZXJ5Vm9sdGFnZSA9IHt9OwogICAgYmF0dGVyeVZvbHRhZ2UuY2hhbm5lbElkID0gMjsKICAgIGJhdHRlcnlWb2x0YWdlLmNoYW5uZWxOYW1lID0gQ0hBTk5FTF9OQU1FU19ESUNUSU9OQVJZW2JhdHRlcnlWb2x0YWdlLmNoYW5uZWxJZF07CiAgICAvLyBiYXR0ZXJ5IHZvbHRhZ2UgaW4gViBhcyBzaW5nbGUgbm90IGRvdWJsZQogICAgYmF0dGVyeVZvbHRhZ2UudmFsdWUgPSAoaW5wdXQuYnl0ZXNbMl0gLyAxMCk7CiAgICBvdXRwdXQuZGF0YS5tZWFzdXJlbWVudC5jaGFubmVscy5wdXNoKGJhdHRlcnlWb2x0YWdlKTsKICAgIAogICAgcmV0dXJuIG91dHB1dDsKfQoKLyoqCiAqIERlY29kZXMgYSBwcm9jZXNzIGFsYXJtIDAzIGludG8gYW4gb2JqZWN0CiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0ge09iamVjdH0gICAgICAgICAgaW5wdXQgICAgICAgICAgIC0gQW4gb2JqZWN0IHByb3ZpZGVkIGJ5IHRoZSBJb1QgRmxvdyBmcmFtZXdvcmsKICogQHBhcmFtIHtudW1iZXJbXX0gICAgICAgIGlucHV0LmJ5dGVzICAgICAtIEFycmF5IG9mIGJ5dGVzIHJlcHJlc2VudGVkIGFzIG51bWJlcnMgYXMgaXQgaGFzIGJlZW4gc2VudCBmcm9tIHRoZSBkZXZpY2UKICogQHBhcmFtIHtudW1iZXJ9ICAgICAgICAgIGlucHV0LmZQb3J0ICAgICAtIFRoZSBQb3J0IEZpZWxkIG9uIHdoaWNoIHRoZSB1cGxpbmsgaGFzIGJlZW4gc2VudAogKiBAcGFyYW0ge0RhdGV9ICAgICAgICAgICAgaW5wdXQucmVjdlRpbWUgIC0gVGhlIHVwbGluayBtZXNzYWdlIHRpbWUgcmVjb3JkZWQgYnkgdGhlIExvUmFXQU4gbmV0d29yayBzZXJ2ZXIKICogQHJldHVybnMge291dHB1dH0gICAgICAgICAgICAgICAgICAgICAgICAtIFRoZSBkZWNvZGVkIG9iamVjdAogKi8KZnVuY3Rpb24gZGVjb2RlUHJvY2Vzc0FsYXJtKGlucHV0KSB7CgogICAgdmFyIG91dHB1dCA9IGNyZWF0ZU91dHB1dE9iamVjdCgpOwogICAgb3V0cHV0LmRhdGEucHJvY2Vzc0FsYXJtcyA9IFtdOwoKICAgIC8vIGRhdGEgbWVzc2FnZSB0eXBlCiAgICBvdXRwdXQuZGF0YS5tZXNzYWdlVHlwZSA9IGlucHV0LmJ5dGVzWzBdOwoKICAgIC8vIGN1cnJlbnQgY29uZmlndXJhdGlvbiBpZAogICAgb3V0cHV0LmRhdGEuY29uZmlndXJhdGlvbklkID0gaW5wdXQuYnl0ZXNbMV07CgogICAgZm9yICh2YXIgYnl0ZUluZGV4ID0gMiwgYWxhcm1Db3VudGVyID0gMDsgYnl0ZUluZGV4IDwgaW5wdXQuYnl0ZXMubGVuZ3RoOyBieXRlSW5kZXggKz0gMywgYWxhcm1Db3VudGVyKyspIHsKICAgICAgICBvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0gPSB7fTsKCiAgICAgICAgLy8gQWxhcm0gZXZlbnQgMCA9IHRyaWdnZXJlZCwgMSA9IGRpc2FwcGVhcmVkCiAgICAgICAgb3V0cHV0LmRhdGEucHJvY2Vzc0FsYXJtc1thbGFybUNvdW50ZXJdLmV2ZW50ID0gKGlucHV0LmJ5dGVzW2J5dGVJbmRleF0gJiAweDgwKSA+PiA3OwogICAgICAgIG91dHB1dC5kYXRhLnByb2Nlc3NBbGFybXNbYWxhcm1Db3VudGVyXS5ldmVudE5hbWUgPSBBTEFSTV9FVkVOVF9OQU1FU19ESUNUSU9OQVJZW291dHB1dC5kYXRhLnByb2Nlc3NBbGFybXNbYWxhcm1Db3VudGVyXS5ldmVudF07CgogICAgICAgIC8vIEFsYXJtIGNoYW5uZWwgMCA9IHByZXNzdXJlLCAxID0gZGV2aWNlIHRlbXBlcmF0dXJlCiAgICAgICAgb3V0cHV0LmRhdGEucHJvY2Vzc0FsYXJtc1thbGFybUNvdW50ZXJdLmNoYW5uZWxJZCA9IChpbnB1dC5ieXRlc1tieXRlSW5kZXhdICYgMHg3OCkgPj4gMzsKICAgICAgICBvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0uY2hhbm5lbE5hbWUgPSBBTEFSTV9DSEFOTkVMX05BTUVTX0RJQ1RJT05BUllbb3V0cHV0LmRhdGEucHJvY2Vzc0FsYXJtc1thbGFybUNvdW50ZXJdLmNoYW5uZWxJZF07CgogICAgICAgIC8vIEFsYXJtIGNoYW5uZWwgMCA9IGZhbGxpbmcgdGhyZXNoLCAxID0gcmlzaW5nIHRocmVzaCwgMiA9IGZhbCBzbG9wZSwgMyA9IHJpc2luZyBzbG9wZSwgNCA9IGZhbGwgdGhyZXNoIGRlbGF5LCA1ID0gcmlzZSB0aHJlc2ggZGVsYXkKICAgICAgICBvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0uYWxhcm1UeXBlID0gKGlucHV0LmJ5dGVzW2J5dGVJbmRleF0gJiAweDA3KTsKICAgICAgICBvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0uYWxhcm1UeXBlTmFtZSA9IFBST0NFU1NfQUxBUk1fVFlQRV9OQU1FU19ESUNUSU9OQVJZW291dHB1dC5kYXRhLnByb2Nlc3NBbGFybXNbYWxhcm1Db3VudGVyXS5hbGFybVR5cGVdOwoKICAgICAgICAvLyBBbGFybSB2YWx1ZQogICAgICAgIG91dHB1dC5kYXRhLnByb2Nlc3NBbGFybXNbYWxhcm1Db3VudGVyXS52YWx1ZSA9IGdldFJlYWxWYWx1ZUJ5Q2hhbm5lbE51bWJlckFuZEFsYXJtVHlwZShvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0uY2hhbm5lbElkLCAKICAgICAgICAgICAgb3V0cHV0LmRhdGEucHJvY2Vzc0FsYXJtc1thbGFybUNvdW50ZXJdLmFsYXJtVHlwZSwKICAgICAgICAgICAgaW5wdXQuYnl0ZXNbYnl0ZUluZGV4ICsgMV0gPDwgOCB8IGlucHV0LmJ5dGVzW2J5dGVJbmRleCArIDJdKTsKICAgICAgICAgICAgCiAgICAgICAgaWYgKG91dHB1dC5kYXRhLnByb2Nlc3NBbGFybXNbYWxhcm1Db3VudGVyXS52YWx1ZSA9PSBFUlJPUl9WQUxVRSkgewogICAgICAgICAgICBvdXRwdXQgPSBhZGRXYXJuaW5nTWVzc2FnZShvdXRwdXQsICJJbnZhbGlkIGRhdGEgZm9yICIgKyBvdXRwdXQuZGF0YS5wcm9jZXNzQWxhcm1zW2FsYXJtQ291bnRlcl0uY2hhbm5lbE5hbWUgKyAiY2hhbm5lbCIpOwogICAgICAgIH0KCiAgICB9CgogICAgcmV0dXJuIG91dHB1dDsKfQoKLyoqCiAqIERlY29kZXMgYSB0ZWNobmljYWwgYWxhcm0gMDQgaW50byBhbiBvYmplY3QKICogQGFjY2VzcyBwcml2YXRlCiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICBpbnB1dCAgICAgICAgICAgLSBBbiBvYmplY3QgcHJvdmlkZWQgYnkgdGhlIElvVCBGbG93IGZyYW1ld29yawogKiBAcGFyYW0ge251bWJlcltdfSAgICAgICAgaW5wdXQuYnl0ZXMgICAgIC0gQXJyYXkgb2YgYnl0ZXMgcmVwcmVzZW50ZWQgYXMgbnVtYmVycyBhcyBpdCBoYXMgYmVlbiBzZW50IGZyb20gdGhlIGRldmljZQogKiBAcGFyYW0ge251bWJlcn0gICAgICAgICAgaW5wdXQuZlBvcnQgICAgIC0gVGhlIFBvcnQgRmllbGQgb24gd2hpY2ggdGhlIHVwbGluayBoYXMgYmVlbiBzZW50CiAqIEBwYXJhbSB7RGF0ZX0gICAgICAgICAgICBpbnB1dC5yZWN2VGltZSAgLSBUaGUgdXBsaW5rIG1lc3NhZ2UgdGltZSByZWNvcmRlZCBieSB0aGUgTG9SYVdBTiBuZXR3b3JrIHNlcnZlcgogKiBAcmV0dXJucyB7b3V0cHV0fSAgICAgICAgICAgICAgICAgLSBUaGUgZGVjb2RlZCBvYmplY3QKICovCmZ1bmN0aW9uIGRlY29kZVRlY2huaWNhbEFsYXJtKGlucHV0KSB7CiAgICAvLyBPdXRwdXQKICAgIHZhciBvdXRwdXQgPSBjcmVhdGVPdXRwdXRPYmplY3QoKTsKICAgIG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtcyA9IFtdOwoKICAgIC8vIGRhdGEgbWVzc2FnZSB0eXBlCiAgICBvdXRwdXQuZGF0YS5tZXNzYWdlVHlwZSA9IGlucHV0LmJ5dGVzWzBdOwoKICAgIC8vIGN1cnJlbnQgY29uZmlndXJhdGlvbiBpZAogICAgb3V0cHV0LmRhdGEuY29uZmlndXJhdGlvbklkID0gaW5wdXQuYnl0ZXNbMV07CgogICAgZm9yICh2YXIgYnl0ZUluZGV4ID0gMiwgYWxhcm1Db3VudGVyID0gMDsgYnl0ZUluZGV4IDwgaW5wdXQuYnl0ZXMubGVuZ3RoOyBieXRlSW5kZXggKz0gMywgYWxhcm1Db3VudGVyKyspIHsKICAgICAgICBvdXRwdXQuZGF0YS50ZWNobmljYWxBbGFybXNbYWxhcm1Db3VudGVyXSA9IHt9OwoKICAgICAgICAvLyBBbGFybSBldmVudCAwID0gdHJpZ2dlcmVkLCAxID0gZGlzYXBwZWFyZWQKICAgICAgICBvdXRwdXQuZGF0YS50ZWNobmljYWxBbGFybXNbYWxhcm1Db3VudGVyXS5ldmVudCA9IChpbnB1dC5ieXRlc1tieXRlSW5kZXhdICYgMHg4MCkgPj4gNzsKICAgICAgICBvdXRwdXQuZGF0YS50ZWNobmljYWxBbGFybXNbYWxhcm1Db3VudGVyXS5ldmVudE5hbWUgPSBBTEFSTV9FVkVOVF9OQU1FU19ESUNUSU9OQVJZW291dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLmV2ZW50XTsKCiAgICAgICAgLy8gQWxhcm0gY2hhbm5lbCAwID0gcHJlc3N1cmUsIDEgPSBkZXZpY2UgdGVtcGVyYXR1cmUKICAgICAgICBvdXRwdXQuZGF0YS50ZWNobmljYWxBbGFybXNbYWxhcm1Db3VudGVyXS5jaGFubmVsSWQgPSAoaW5wdXQuYnl0ZXNbYnl0ZUluZGV4XSAmIDB4NzgpID4+IDM7CiAgICAgICAgb3V0cHV0LmRhdGEudGVjaG5pY2FsQWxhcm1zW2FsYXJtQ291bnRlcl0uY2hhbm5lbE5hbWUgPSBBTEFSTV9DSEFOTkVMX05BTUVTX0RJQ1RJT05BUllbb3V0cHV0LmRhdGEudGVjaG5pY2FsQWxhcm1zW2FsYXJtQ291bnRlcl0uY2hhbm5lbElkXTsKCiAgICAgICAgLy8gQWxhcm0gY2hhbm5lbCAxID0gZ2VuZXJhbCBmYWlsdXJlCiAgICAgICAgb3V0cHV0LmRhdGEudGVjaG5pY2FsQWxhcm1zW2FsYXJtQ291bnRlcl0uY2F1c2VPZkZhaWx1cmUgPSAoaW5wdXQuYnl0ZXNbYnl0ZUluZGV4XSAmIDB4MDcpOwogICAgICAgIG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLmNhdXNlT2ZGYWlsdXJlTmFtZSA9IFRFQ0hOSUNBTF9BTEFSTV9DQVVTRV9PRl9GQUlMVVJFX05BTUVTX0RJQ1RJT05BUllbb3V0cHV0LmRhdGEudGVjaG5pY2FsQWxhcm1zW2FsYXJtQ291bnRlcl0uY2F1c2VPZkZhaWx1cmVdOwoKICAgICAgICAvLyBBbGFybSB2YWx1ZQogICAgICAgIG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLnZhbHVlID0gZ2V0UmVhbFZhbHVlQnlDaGFubmVsTnVtYmVyQW5kQWxhcm1UeXBlKG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLmNoYW5uZWxJZCwgMCwKICAgICAgICAgICAgaW5wdXQuYnl0ZXNbYnl0ZUluZGV4ICsgMV0gPDwgOCB8IGlucHV0LmJ5dGVzW2J5dGVJbmRleCArIDJdKTsKCiAgICAgICAgaWYgKG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLnZhbHVlID09IEVSUk9SX1ZBTFVFKSB7CiAgICAgICAgICAgIG91dHB1dCA9IGFkZFdhcm5pbmdNZXNzYWdlKG91dHB1dCwgIkludmFsaWQgZGF0YSBmb3IgIiArIG91dHB1dC5kYXRhLnRlY2huaWNhbEFsYXJtc1thbGFybUNvdW50ZXJdLmNoYW5uZWxOYW1lICsgImNoYW5uZWwiKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIG91dHB1dDsKfQoKLyoqCiAqIERlY29kZXMgYSBkZXZpY2UgYWxhcm0gMDUgaW50byBhbiBvYmplY3QKICogQGFjY2VzcyBwcml2YXRlCiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgaW5wdXQgICAgICAgICAgIC0gQW4gb2JqZWN0IHByb3ZpZGVkIGJ5IHRoZSBJb1QgRmxvdyBmcmFtZXdvcmsKICogQHBhcmFtIHtudW1iZXJbXX0gICAgICAgICAgICBpbnB1dC5ieXRlcyAgICAgLSBBcnJheSBvZiBieXRlcyByZXByZXNlbnRlZCBhcyBudW1iZXJzIGFzIGl0IGhhcyBiZWVuIHNlbnQgZnJvbSB0aGUgZGV2aWNlCiAqIEBwYXJhbSB7bnVtYmVyfSAgICAgICAgICAgICAgaW5wdXQuZlBvcnQgICAgIC0gVGhlIFBvcnQgRmllbGQgb24gd2hpY2ggdGhlIHVwbGluayBoYXMgYmVlbiBzZW50CiAqIEBwYXJhbSB7RGF0ZX0gICAgICAgICAgICAgICAgaW5wdXQucmVjdlRpbWUgIC0gVGhlIHVwbGluayBtZXNzYWdlIHRpbWUgcmVjb3JkZWQgYnkgdGhlIExvUmFXQU4gbmV0d29yayBzZXJ2ZXIKICogQHJldHVybnMge291dHB1dH0gICAgICAgICAgICAgICAgICAgICAtIFRoZSBkZWNvZGVkIG9iamVjdAogKi8KZnVuY3Rpb24gZGVjb2RlRGV2aWNlQWxhcm0oaW5wdXQpIHsKICAgIC8vIE91dHB1dAogICAgdmFyIG91dHB1dCA9IGNyZWF0ZU91dHB1dE9iamVjdCgpOwoKICAgIC8vIGRhdGEgbWVzc2FnZSB0eXBlCiAgICBvdXRwdXQuZGF0YS5tZXNzYWdlVHlwZSA9IGlucHV0LmJ5dGVzWzBdOwoKICAgIC8vIGN1cnJlbnQgY29uZmlndXJhdGlvbiBpZAogICAgb3V0cHV0LmRhdGEuY29uZmlndXJhdGlvbklkID0gaW5wdXQuYnl0ZXNbMV07CgogICAgLy8gQ3JlYXRlIGRldmljZUFsYXJtCiAgICBvdXRwdXQuZGF0YS5kZXZpY2VBbGFybSA9IHt9OwoKICAgIC8vIEFsYXJtIGV2ZW50IDAgPSB0cmlnZ2VyZWQsIDEgPSBkaXNhcHBlYXJlZAogICAgb3V0cHV0LmRhdGEuZGV2aWNlQWxhcm0uZXZlbnQgPSAoaW5wdXQuYnl0ZXNbMl0gJiAweDgwKSA+PiA3OwogICAgb3V0cHV0LmRhdGEuZGV2aWNlQWxhcm0uZXZlbnROYW1lID0gQUxBUk1fRVZFTlRfTkFNRVNfRElDVElPTkFSWVtvdXRwdXQuZGF0YS5kZXZpY2VBbGFybS5ldmVudF07CgogICAgLy8gR2VuZXJpYyBvciBkZXZpY2UgZGVwZW5kZW50IDEgPSBkZXZpY2UgZGVwZW5kZW50ICAgIAogICAgb3V0cHV0LmRhdGEuZGV2aWNlQWxhcm0uY2F1c2VPZkZhaWx1cmUgPSAoaW5wdXQuYnl0ZXNbMl0gJiAweDYwKSA+PiA2OwogICAgb3V0cHV0LmRhdGEuZGV2aWNlQWxhcm0uY2F1c2VPZkZhaWx1cmVOYW1lID0gREVWSUNFX0FMQVJNX0NBVVNFX09GX0ZBSUxVUkVfTkFNRVNfRElDVElPTkFSWVtvdXRwdXQuZGF0YS5kZXZpY2VBbGFybS5jYXVzZU9mRmFpbHVyZV07CgogICAgLy8gQWxhcm0gdHlwZSAwID0gbG93IHRlbXBlcmF0dXJlIGFsYXJtCiAgICBvdXRwdXQuZGF0YS5kZXZpY2VBbGFybS5hbGFybVR5cGUgPSAoaW5wdXQuYnl0ZXNbMl0gJiAweDFmKTsKICAgIG91dHB1dC5kYXRhLmRldmljZUFsYXJtLmFsYXJtVHlwZU5hbWUgPSBERVZJQ0VfQUxBUk1fVFlQRV9OQU1FU19ESUNUSU9OQVJZW291dHB1dC5kYXRhLmRldmljZUFsYXJtLmFsYXJtVHlwZV07CgogICAgLy8gVGhlIGFsYXJtIHZhbHVlIGlzIGFuIGludDgsIGJ1dCB3ZSBoYXZlIGFuIGludDMyLCBzbyB3ZSBzaGlmdCAyNCBiaXRzIHRvIHRoZSBsZWZ0IGFuZCAyNCBiaXRzIHRvIHRoZSByaWdodCAKICAgIC8vIGFuZCBhcyBhIHJlc3VsdCB3ZSBnZXQgYW4gOCBiaXQgaW50ZWdlciBpbiBhIDMyIGJpdCBpbnRlZ2VyCiAgICBvdXRwdXQuZGF0YS5kZXZpY2VBbGFybS52YWx1ZSA9IGlucHV0LmJ5dGVzWzNdIDw8IDI0ID4+IDI0OwoKICAgIHJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBEZWNvZGVzIGEga2VlcCBhbGl2ZSBtZXNzYWdlIDA4IGludG8gYW4gb2JqZWN0CiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0ge09iamVjdH0gICAgICAgICAgICAgIGlucHV0ICAgICAgICAgICAtIEFuIG9iamVjdCBwcm92aWRlZCBieSB0aGUgSW9UIEZsb3cgZnJhbWV3b3JrCiAqIEBwYXJhbSB7bnVtYmVyW119ICAgICAgICAgICAgaW5wdXQuYnl0ZXMgICAgIC0gQXJyYXkgb2YgYnl0ZXMgcmVwcmVzZW50ZWQgYXMgbnVtYmVycyBhcyBpdCBoYXMgYmVlbiBzZW50IGZyb20gdGhlIGRldmljZQogKiBAcGFyYW0ge251bWJlcn0gICAgICAgICAgICAgIGlucHV0LmZQb3J0ICAgICAtIFRoZSBQb3J0IEZpZWxkIG9uIHdoaWNoIHRoZSB1cGxpbmsgaGFzIGJlZW4gc2VudAogKiBAcGFyYW0ge0RhdGV9ICAgICAgICAgICAgICAgIGlucHV0LnJlY3ZUaW1lICAtIFRoZSB1cGxpbmsgbWVzc2FnZSB0aW1lIHJlY29yZGVkIGJ5IHRoZSBMb1JhV0FOIG5ldHdvcmsgc2VydmVyCiAqIEByZXR1cm5zIHtvdXRwdXR9ICAgICAgICAgICAgICAgICAgICAgLSBUaGUgZGVjb2RlZCBvYmplY3QKICovCmZ1bmN0aW9uIGRlY29kZUtlZXBBbGl2ZU1lc3NhZ2UoaW5wdXQpIHsKICAgIC8vIE91dHB1dAogICAgdmFyIG91dHB1dCA9IGNyZWF0ZU91dHB1dE9iamVjdCgpOwoKICAgIC8vIGRhdGEgbWVzc2FnZSB0eXBlCiAgICBvdXRwdXQuZGF0YS5tZXNzYWdlVHlwZSA9IGlucHV0LmJ5dGVzWzBdOwoKICAgIC8vIGN1cnJlbnQgY29uZmlndXJhdGlvbiBpZAogICAgb3V0cHV0LmRhdGEuY29uZmlndXJhdGlvbklkID0gaW5wdXQuYnl0ZXNbMV07CgogICAgb3V0cHV0LmRhdGEuZGV2aWNlU3RhdGlzdGljID0ge307CiAgICAvLyBCYXR0ZXJ5IGxldmVsIGV2ZW50IGluZGljYXRvcgogICAgb3V0cHV0LmRhdGEuZGV2aWNlU3RhdGlzdGljLmJhdHRlcnlMZXZlbE5ld0V2ZW50ID0gKGlucHV0LmJ5dGVzWzJdICYgMHg4MCkgPj4gNyA/IHRydWUgOiBmYWxzZTsKCiAgICAvLyBiYXR0ZXJ5IGxldmVsIGluIHBlcmNlbnQKICAgIG91dHB1dC5kYXRhLmRldmljZVN0YXRpc3RpYy5iYXR0ZXJ5TGV2ZWxQZXJjZW50ID0gaW5wdXQuYnl0ZXNbMl0gJiAweDdmOwoKICAgIHJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBEZWNvZGVzIGEgZGV2aWNlIGlkZW50aWZpY2F0aW9uIG1lc3NhZ2UgMDcgaW50byBhbiBvYmplY3QKICogQGFjY2VzcyBwcml2YXRlCiAqIEBwYXJhbSB7T2JqZWN0fSAgICAgICAgICAgICAgaW5wdXQgICAgICAgICAgIC0gQW4gb2JqZWN0IHByb3ZpZGVkIGJ5IHRoZSBJb1QgRmxvdyBmcmFtZXdvcmsKICogQHBhcmFtIHtudW1iZXJbXX0gICAgICAgICAgICBpbnB1dC5ieXRlcyAgICAgLSBBcnJheSBvZiBieXRlcyByZXByZXNlbnRlZCBhcyBudW1iZXJzIGFzIGl0IGhhcyBiZWVuIHNlbnQgZnJvbSB0aGUgZGV2aWNlCiAqIEBwYXJhbSB7bnVtYmVyfSAgICAgICAgICAgICAgaW5wdXQuZlBvcnQgICAgIC0gVGhlIFBvcnQgRmllbGQgb24gd2hpY2ggdGhlIHVwbGluayBoYXMgYmVlbiBzZW50CiAqIEBwYXJhbSB7RGF0ZX0gICAgICAgICAgICAgICAgaW5wdXQucmVjdlRpbWUgIC0gVGhlIHVwbGluayBtZXNzYWdlIHRpbWUgcmVjb3JkZWQgYnkgdGhlIExvUmFXQU4gbmV0d29yayBzZXJ2ZXIKICogQHJldHVybnMge291dHB1dH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgLSBUaGUgZGVjb2RlZCBvYmplY3QKICovCmZ1bmN0aW9uIGRlY29kZURldmljZUlkZW50aWZpY2F0aW9uKGlucHV0KSB7CiAgICAvLyBPdXRwdXQKICAgIHZhciBvdXRwdXQgPSBjcmVhdGVPdXRwdXRPYmplY3QoKTsKCiAgICAvLyBEYXRhIG1lc3NhZ2UgdHlwZSAgICAKICAgIG91dHB1dC5kYXRhLm1lc3NhZ2VUeXBlID0gaW5wdXQuYnl0ZXNbMF07CgogICAgLy8gQ29uZmlndXJhdGlvbiBpZAogICAgb3V0cHV0LmRhdGEuY29uZmlndXJhdGlvbklkID0gaW5wdXQuYnl0ZXNbMV07CgogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24gPSB7fTsKICAgIC8vIFByb2R1Y3QgaWQgcmF3CiAgICBvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5wcm9kdWN0SWQgPSBpbnB1dC5ieXRlc1syXTsKCiAgICAvLyBXaXJlbGVzcyBtb2R1bGUgdHlwZQogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJvZHVjdElkTmFtZSA9IGlucHV0LmJ5dGVzWzJdID09IDEwID8gIlBHVzIzLjEwMC4xMSIgOiBpbnB1dC5ieXRlc1syXTsKCiAgICAvLyBXaXJlbGVzcyBtb2R1bGUgZmlybXdhcmUgdmVyc2lvbgogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ud2lyZWxlc3NNb2R1bGVGaXJtd2FyZVZlcnNpb24gPSAoKGlucHV0LmJ5dGVzWzNdID4+IDQpICYgMHgwZikudG9TdHJpbmcoKSArICIuIiArIChpbnB1dC5ieXRlc1szXSAmIDB4MGYpLnRvU3RyaW5nKCkgKyAiLiIgKyAoaW5wdXQuYnl0ZXNbNF0pLnRvU3RyaW5nKCk7CgogICAgLy8gV2lyZWxlc3MgbW9kdWxlIGhhcmR3YXJlIHZlcnNpb24KICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLndpcmVsZXNzTW9kdWxlSGFyZHdhcmVWZXJzaW9uID0gKChpbnB1dC5ieXRlc1s1XSA+PiA0KSAmIDB4MGYpLnRvU3RyaW5nKCkgKyAiLiIgKyAoaW5wdXQuYnl0ZXNbNV0gJiAweDBmKS50b1N0cmluZygpICsgIi4iICsgKGlucHV0LmJ5dGVzWzZdKS50b1N0cmluZygpOwoKICAgIC8vIFNlbnNvciBtb2R1bGUgZmlybXdhcmUgdmVyc2lvbgogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24uc2Vuc29yTW9kdWxlRmlybXdhcmVWZXJzaW9uID0gKChpbnB1dC5ieXRlc1s3XSA+PiA0KSAmIDB4MGYpLnRvU3RyaW5nKCkgKyAiLiIgKyAoaW5wdXQuYnl0ZXNbN10gJiAweDBmKS50b1N0cmluZygpICsgIi4iICsgKGlucHV0LmJ5dGVzWzhdKS50b1N0cmluZygpOwoKICAgIC8vIFNlbnNvciBtb2R1bGUgaGFyZHdhcmUgdmVyc2lvbgogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24uc2Vuc29yTW9kdWxlSGFyZHdhcmVWZXJzaW9uID0gKChpbnB1dC5ieXRlc1s5XSA+PiA0KSAmIDB4MGYpLnRvU3RyaW5nKCkgKyAiLiIgKyAoaW5wdXQuYnl0ZXNbOV0gJiAweDBmKS50b1N0cmluZygpICsgIi4iICsgKGlucHV0LmJ5dGVzWzEwXSkudG9TdHJpbmcoKTsKCiAgICAvLyBTZW5zb3Igc2VyaWFsIG51bWJlcgogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24uc2VyaWFsTnVtYmVyID0gIiI7CiAgICBmb3IgKHZhciBpID0gMTE7IGkgPCAyMjsgaSsrKSB7CiAgICAgICAgaWYgKGlucHV0LmJ5dGVzW2ldID09IDApIGJyZWFrOwogICAgICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLnNlcmlhbE51bWJlciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGlucHV0LmJ5dGVzW2ldKTsKICAgIH0KCiAgICAvLyBQcmVzc3VyZSB0eXBlCiAgICBzd2l0Y2ggKGlucHV0LmJ5dGVzWzIyXSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJlc3N1cmVUeXBlID0gImFic29sdXRlIjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJlc3N1cmVUeXBlID0gInJlbGF0aXZlIjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJlc3N1cmVUeXBlID0gImRpZmZlcmVudGlhbCI7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5wcmVzc3VyZVR5cGUgPSAidW5rbm93biI7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIC8vIE1pbiByYW5nZSBwcmVzc3VyZQogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ubWVhc3VyZW1lbnRSYW5nZVN0YXJ0UHJlc3N1cmUgPSBjb252ZXJ0SGV4VG9GbG9hdElFRUU3NTQoaW5wdXQuYnl0ZXNbMjZdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMjVdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMjRdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMjNdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKTsKICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLm1lYXN1cmVtZW50UmFuZ2VTdGFydFByZXNzdXJlID0gTnVtYmVyKG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLm1lYXN1cmVtZW50UmFuZ2VTdGFydFByZXNzdXJlLnRvRml4ZWQoNikpOwoKICAgIC8vIE1heCByYW5nZSBwcmVzc3VyZQogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ubWVhc3VyZW1lbnRSYW5nZUVuZFByZXNzdXJlID0gY29udmVydEhleFRvRmxvYXRJRUVFNzU0KGlucHV0LmJ5dGVzWzMwXS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzI5XS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzI4XS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzI3XS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSk7CiAgICBvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5tZWFzdXJlbWVudFJhbmdlRW5kUHJlc3N1cmUgPSBOdW1iZXIob3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ubWVhc3VyZW1lbnRSYW5nZUVuZFByZXNzdXJlLnRvRml4ZWQoNikpOwoKICAgIC8vIE1pbiByYW5nZSBkZXZpY2UgdGVtcGVyYXR1cmUKICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLm1lYXN1cmVtZW50UmFuZ2VTdGFydERldmljZVRlbXBlcmF0dXJlID0gY29udmVydEhleFRvRmxvYXRJRUVFNzU0KGlucHV0LmJ5dGVzWzM0XS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzMzXS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzMyXS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSArIGlucHV0LmJ5dGVzWzMxXS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgIjAiKSk7CiAgICBvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5tZWFzdXJlbWVudFJhbmdlU3RhcnREZXZpY2VUZW1wZXJhdHVyZSA9IE51bWJlcihvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5tZWFzdXJlbWVudFJhbmdlU3RhcnREZXZpY2VUZW1wZXJhdHVyZS50b0ZpeGVkKDYpKTsKCiAgICAvLyBNYXggcmFuZ2UgZGV2aWNlIHRlbXBlcmF0dXJlCiAgICBvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5tZWFzdXJlbWVudFJhbmdlRW5kRGV2aWNlVGVtcGVyYXR1cmUgPSBjb252ZXJ0SGV4VG9GbG9hdElFRUU3NTQoaW5wdXQuYnl0ZXNbMzhdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMzddLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMzZdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpICsgaW5wdXQuYnl0ZXNbMzVdLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKTsKICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLm1lYXN1cmVtZW50UmFuZ2VFbmREZXZpY2VUZW1wZXJhdHVyZSA9IE51bWJlcihvdXRwdXQuZGF0YS5kZXZpY2VJbmZvcm1hdGlvbi5tZWFzdXJlbWVudFJhbmdlRW5kRGV2aWNlVGVtcGVyYXR1cmUudG9GaXhlZCg2KSk7CgogICAgLy8gVW5pdCBwcmVzc3VyZQogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJlc3N1cmVVbml0ID0gaW5wdXQuYnl0ZXNbMzldOwogICAgb3V0cHV0LmRhdGEuZGV2aWNlSW5mb3JtYXRpb24ucHJlc3N1cmVVbml0TmFtZSA9IHJldHVyblBoeXNpY2FsVW5pdEZyb21JZChpbnB1dC5ieXRlc1szOV0pOwoKICAgIC8vIFVuaXQgcHJlc3N1cmUKICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLmRldmljZVRlbXBlcmF0dXJlVW5pdCA9IGlucHV0LmJ5dGVzWzQwXTsKICAgIG91dHB1dC5kYXRhLmRldmljZUluZm9ybWF0aW9uLmRldmljZVRlbXBlcmF0dXJlVW5pdE5hbWUgPSByZXR1cm5QaHlzaWNhbFVuaXRGcm9tSWQoaW5wdXQuYnl0ZXNbNDBdKTsKCiAgICByZXR1cm4gb3V0cHV0Owp9Ci8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCi8vICAgICAgICAgIEFkZGl0aW9uYWwgRnVuY3Rpb25zIFNlY3Rpb24KLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLyoqCiAqIENvbnZlcnRzIGEgaGV4IHN0cmluZyBudW1iZXIgdG8gZmxvYXQgbnVtYmVyIGZvbGxvd3MgdGhlIElFRUUgNzU0IHN0YW5kYXJkIGFuZCBpdCdzIEVTNSBjb21wYXRpYmxlCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0gIHtzdHJpbmd9IGhleFN0cmluZyAgIC0gRmxvYXQgYXMgc3RyaW5nICIzLjE0MSIKICogQHJldHVybiB7bnVtYmVyfSAgICAgICAgICAgICAtIHJldHVybnMgYSBmbG9hdAogKiBAc2VlIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL0pvem8xMzIvMmMwZmFlNzYzZjVkYzY2MzVhNjcxNGJiNzQxZDE1MmYgMjAyMiBieSBKb3pvMTMyIAogKi8KZnVuY3Rpb24gY29udmVydEhleFRvRmxvYXRJRUVFNzU0KGhleFN0cmluZykgewogICAgdmFyIGludCA9IHBhcnNlSW50KGhleFN0cmluZywgMTYpOwogICAgaWYgKGludCA+IDAgfHwgaW50IDwgMCkgewogICAgICAgIHZhciBzaWduID0gKGludCA+Pj4gMzEpID8gLTEgOiAxOwogICAgICAgIHZhciBleHAgPSAoaW50ID4+PiAyMyAmIDB4ZmYpIC0gMTI3OwogICAgICAgIHZhciBtYW50aXNzYSA9ICgoaW50ICYgMHg3ZmZmZmYpICsgMHg4MDAwMDApLnRvU3RyaW5nKDIpOwogICAgICAgIHZhciBmbG9hdDMyID0gMAogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFudGlzc2EubGVuZ3RoOyBpICs9IDEpIHsgZmxvYXQzMiArPSBwYXJzZUludChtYW50aXNzYVtpXSkgPyBNYXRoLnBvdygyLCBleHApIDogMDsgZXhwLS0gfQogICAgICAgIHJldHVybiBmbG9hdDMyICogc2lnbjsKICAgIH0gZWxzZSByZXR1cm4gMAp9CgovKioKICogQ2hlY2tzIHRoZSB1c2VyIGRlZmluZWQgbWVhc3VyZW1lbnQgcmFuZ2VzCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0gIHtvdXRwdXR9IG91dHB1dCAtIE91dHB1dCBvYmplY3QKICogQHJldHVybiB7b3V0cHV0fSAgICAgICAgLSBSZXR1cm5zIGlmIHRoZSByYW5nZXMgYXJlIGNvcnJlY3QgZGVmaW5lZAogKi8KZnVuY3Rpb24gY2hlY2tNZWFzdXJlbWVudFJhbmdlcyhvdXRwdXQpIHsKICAgIGlmICh0eXBlb2YgUFJFU1NVUkVfUkFOR0VfU1RBUlQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgb3V0cHV0ID0gYWRkRXJyb3JNZXNzYWdlKG91dHB1dCwgIlRoZSBQUkVTU1VSRV9SQU5HRV9TVEFSVCB3YXMgbm90IHNldC4iKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIFBSRVNTVVJFX1JBTkdFX0VORCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiVGhlIFBSRVNTVVJFX1JBTkdFX0VORCB3YXMgbm90IHNldC4iKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiVGhlIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCB3YXMgbm90IHNldC4iKTsKICAgIH0KCiAgICBpZiAodHlwZW9mIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9FTkQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgb3V0cHV0ID0gYWRkRXJyb3JNZXNzYWdlKG91dHB1dCwgIlRoZSBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfRU5EIHdhcyBub3Qgc2V0LiIpOwogICAgfQoKICAgIGlmIChQUkVTU1VSRV9SQU5HRV9TVEFSVCA+PSBQUkVTU1VSRV9SQU5HRV9FTkQpIHsKICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiVGhlIFBSRVNTVVJFX1JBTkdFX1NUQVJUIG11c3Qgbm90IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gUFJFU1NVUkVfUkFOR0VfRU5ELCAiICsgUFJFU1NVUkVfUkFOR0VfU1RBUlQgKyAiID49ICIgKyBQUkVTU1VSRV9SQU5HRV9FTkQgKyAiLiAiKTsKICAgIH0KCiAgICBpZiAoREVWSUNFX1RFTVBFUkFUVVJFX1JBTkdFX1NUQVJUID49IERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9FTkQpIHsKICAgICAgICBvdXRwdXQgPSBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCAiVGhlIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCBtdXN0IG5vdCBiZSBncmVhdGVyIG9yIGVxdWFsIHRvIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9FTkQsICIgKyBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfU1RBUlQgKyAiID49ICIgKyBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfRU5EICsgIi4iKTsKICAgIH0KCiAgICByZXR1cm4gb3V0cHV0Owp9CgovKioKICogQWRkIHdhcm5pbmcgdG8gb3V0cHV0IG9iamVjdAogKiBAcGFyYW0ge291dHB1dH0gb3V0cHV0CiAqIEBwYXJhbSB7c3RyaW5nfSB3YXJuaW5nTWVzc2FnZQogKiBAYWNjZXNzIHByaXZhdGUgCiAqLwpmdW5jdGlvbiBhZGRXYXJuaW5nTWVzc2FnZShvdXRwdXQsIHdhcm5pbmdNZXNzYWdlKSB7CiAgICAvLyB1c2Ugb25seSBmdW5jdGlvbmFsIHN1cHBvcnRlZCBieSBFQ01BLTI2MiA1dGggZWRpdGlvbi4gVGhlIG51bGxpc2ggYXNzaWduIGFuZCAuYXQgYXJlIG5vdCBzdXBwb3J0ZWQuIG91dHB1dC53YXJuaW5ncyA/Pz0gW107CiAgICBvdXRwdXQud2FybmluZ3MgPSBvdXRwdXQud2FybmluZ3MgfHwgW107CiAgICBvdXRwdXQud2FybmluZ3MucHVzaChERVZJQ0VfTkFNRSArICIgKEpTKTogIiArIHdhcm5pbmdNZXNzYWdlKTsKICAgIHJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBBZGQgcHJpdmF0ZSB0byBvdXRwdXQgb2JqZWN0CiAqIEBwYXJhbSB7b3V0cHV0fSBvdXRwdXQKICogQHBhcmFtIHtzdHJpbmd9IGVycm9yTWVzc2FnZQogKiBAYWNjZXNzIHByaXZhdGUgCiAqLwpmdW5jdGlvbiBhZGRFcnJvck1lc3NhZ2Uob3V0cHV0LCBlcnJvck1lc3NhZ2UpIHsKICAgIG91dHB1dC5lcnJvcnMgPSBvdXRwdXQuZXJyb3JzIHx8IFtdOwogICAgb3V0cHV0LmVycm9ycy5wdXNoKERFVklDRV9OQU1FICsgIiAoSlMpOiAiICsgZXJyb3JNZXNzYWdlKTsKICAgIHJldHVybiBvdXRwdXQ7Cn0KCi8qKgogKiBDcmVhdGUgYW4gZW1wdHkgb3V0cHV0IG9iamVjdAogKiBAcmV0dXJucyB7b3V0cHV0fSAgICAgICAgLSBSZXR1cm5zIGFuIG91dHB1dCBvYmplY3QKICogQGFjY2VzcyBwcml2YXRlCiAqLwpmdW5jdGlvbiBjcmVhdGVPdXRwdXRPYmplY3QoKSB7CiAgICByZXR1cm4gewogICAgICAgIGRhdGE6IHt9LAogICAgfQp9CgoKLyoqCiAqIFNldCBtZWFzdXJlbWVudCByYW5nZXMgb25seSBmb3IgdGVzdCBwdXJwb3NlcwogKiBAYWNjZXNzIHByb3RlY3RlZAogKiBAcGFyYW0gIHtOdW1iZXJ9IHByZXNzdXJlUmFuZ2VTdGFydCAgIHJhbmdlIHN0YXJ0CiAqIEBwYXJhbSAge051bWJlcn0gcHJlc3N1cmVSYW5nZUVuZCAgICAgcmFuZ2UgZW5kCiAqIEBwYXJhbSAge051bWJlcn0gdGVtcGVyYXR1cmVSYW5nZVN0YXJ0ICAgcmFuZ2Ugc3RhcnQKICogQHBhcmFtICB7TnVtYmVyfSB0ZW1wZXJhdHVyZVJhbmdlRW5kICAgICByYW5nZSBlbmQKICovCmZ1bmN0aW9uIHNldE1lYXN1cmVtZW50UmFuZ2VzKHByZXNzdXJlUmFuZ2VTdGFydCwgcHJlc3N1cmVSYW5nZUVuZCwgdGVtcGVyYXR1cmVSYW5nZVN0YXJ0LCB0ZW1wZXJhdHVyZVJhbmdlRW5kKSB7CiAgICBQUkVTU1VSRV9SQU5HRV9TVEFSVCA9IHByZXNzdXJlUmFuZ2VTdGFydDsKICAgIFBSRVNTVVJFX1JBTkdFX0VORCA9IHByZXNzdXJlUmFuZ2VFbmQ7CiAgICBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfU1RBUlQgPSB0ZW1wZXJhdHVyZVJhbmdlU3RhcnQ7CiAgICBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfRU5EID0gdGVtcGVyYXR1cmVSYW5nZUVuZDsKfQoKCi8qKgogKiBSZXR1cm5zIHRoZSByZWFsIHBoeXNpY2FsIHZhbHVlIG9mIHRoZSBjaGFubmVsIHZhbHVlIGJhc2VkIG9uIG1lYXN1cmVtZW50IHJhbmdlCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKiBAcGFyYW0gIHtOdW1iZXJ9IGNoYW5uZWxWYWx1ZSAgICBjaGFubmVsIHZhbHVlIGFzIGludGVnZXIgCiAqIEBwYXJhbSAge051bWJlcn0gbWVhc3VyZW1lbnRSYW5nZVN0YXJ0ICAgcmFuZ2Ugc3RhcnQKICogQHBhcmFtICB7TnVtYmVyfSBtZWFzdXJlbWVudFJhbmdlRW5kICAgICByYW5nZSBlbmQKICogQHBhcmFtICB7TnVtYmVyfSBtZWFzdXJpbmdSYW5nZVN0YXJ0ICAgcmFuZ2Ugc3RhcnQgKE1SUykKICogQHBhcmFtICB7TnVtYmVyfSBtZWFzdXJpbmdSYW5nZUVuZCAgICAgcmFuZ2UgZW5kIChNUkUpCiAqIEByZXR1cm4ge051bWJlcn0gUmV0dXJucyByZWFsIHBoeXNpY2FsIHZhbHVlIGUuZy4gMTAgwrBDCiAqLwpmdW5jdGlvbiBnZXRDYWxjdWxhdGVkVmFsdWUoY2hhbm5lbFZhbHVlLCBtZWFzdXJlbWVudFJhbmdlU3RhcnQsIG1lYXN1cmVtZW50UmFuZ2VFbmQsIG1lYXN1cmluZ1JhbmdlU3RhcnQsIG1lYXN1cmluZ1JhbmdlRW5kKSB7CiAgICB2YXIgY2FsY3VsYXRlZFZhbHVlID0gKGNoYW5uZWxWYWx1ZSAtIG1lYXN1cmluZ1JhbmdlU3RhcnQpICogKChtZWFzdXJlbWVudFJhbmdlRW5kIC0gbWVhc3VyZW1lbnRSYW5nZVN0YXJ0KSAvIChtZWFzdXJpbmdSYW5nZUVuZCAtIG1lYXN1cmluZ1JhbmdlU3RhcnQpKSArIG1lYXN1cmVtZW50UmFuZ2VTdGFydDsKICAgIC8vIHJvdW5kIHRvIHRoZSB0aGlyZCBudW1iZXIgYWZ0ZXIgdGhlIGNvbW1hCiAgICByZXR1cm4gTWF0aC5yb3VuZChjYWxjdWxhdGVkVmFsdWUgKiAxMDAwKSAvIDEwMDA7Cn0KCi8qKgogKiBSZXR1cm5zIHRoZSByZWFsIHBoeXNpY2FsIHZhbHVlIG9mIHByZXNzdXJlIGJhc2VkIG9uIG1lYXN1cmVtZW50IHJhbmdlCiAqIEBwYXJhbSB7TnVtYmVyfSBjaGFubmVsVmFsdWUgIAogKiBAYWNjZXNzIHByaXZhdGUKICovCmZ1bmN0aW9uIGdldENhbGN1bGF0ZWRQcmVzc3VyZShjaGFubmVsVmFsdWUpIHsKICAgIHJldHVybiBnZXRDYWxjdWxhdGVkVmFsdWUoY2hhbm5lbFZhbHVlLCBQUkVTU1VSRV9SQU5HRV9TVEFSVCwgUFJFU1NVUkVfUkFOR0VfRU5ELCBHRU5FUklDX0RBVEFfQ0hBTk5FTF9SQU5HRV9TVEFSVCwgR0VORVJJQ19EQVRBX0NIQU5ORUxfUkFOR0VfRU5EKTsKfQoKLyoqCiAqIFJldHVybnMgdGhlIHJlYWwgcGh5c2ljYWwgdmFsdWUgb2YgdGVtcGVyYXR1cmUgYmFzZWQgb24gbWVhc3VyZW1lbnQgcmFuZ2UKICogQHBhcmFtIHtOdW1iZXJ9IGNoYW5uZWxWYWx1ZSAgCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKi8KZnVuY3Rpb24gZ2V0Q2FsY3VsYXRlZFRlbXBlcmF0dXJlKGNoYW5uZWxWYWx1ZSkgewogICAgcmV0dXJuIGdldENhbGN1bGF0ZWRWYWx1ZShjaGFubmVsVmFsdWUsIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCwgREVWSUNFX1RFTVBFUkFUVVJFX1JBTkdFX0VORCwgR0VORVJJQ19EQVRBX0NIQU5ORUxfUkFOR0VfU1RBUlQsIEdFTkVSSUNfREFUQV9DSEFOTkVMX1JBTkdFX0VORCk7Cn0KCi8qKgogKiBSZXR1cm5zIHRoZSByZWFsIHBoeXNpY2FsIHZhbHVlIG9mIHRoZSBjaGFubmVsIG51bWJlciBiYXNlZCBvbiBtZWFzdXJlbWVudCByYW5nZQogKiBAcGFyYW0ge051bWJlcn0gY2hhbm5lbFZhbHVlICAKICogQHBhcmFtIHtOdW1iZXJ9IGFsYXJtVHlwZSAgCiAqIEBwYXJhbSB7TnVtYmVyfSBjaGFubmVsTnVtYmVyICAKICogQGFjY2VzcyBwcml2YXRlCiAqLwpmdW5jdGlvbiBnZXRSZWFsVmFsdWVCeUNoYW5uZWxOdW1iZXJBbmRBbGFybVR5cGUoY2hhbm5lbE51bWJlciwgYWxhcm1UeXBlLCBjaGFubmVsVmFsdWUpIHsKICAgIGlmIChjaGFubmVsTnVtYmVyID09IDApIC8vIHByZXNzdXJlIGNoYW5uZWwKICAgIHsKICAgICAgICBpZiAoYWxhcm1UeXBlID09IDMgfHwgYWxhcm1UeXBlID09IDQpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFNsb3BlVmFsdWUoY2hhbm5lbFZhbHVlLCBQUkVTU1VSRV9SQU5HRV9TVEFSVCwgUFJFU1NVUkVfUkFOR0VfRU5EKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBnZXRUaHJlc2hvbGRWYWx1ZShjaGFubmVsVmFsdWUsIFBSRVNTVVJFX1JBTkdFX1NUQVJULCBQUkVTU1VSRV9SQU5HRV9FTkQpOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgaWYgKGNoYW5uZWxOdW1iZXIgPT0gMSkgLy8gdGVtcGVyYXR1cmUgY2hhbm5lbAogICAgewogICAgICAgIGlmIChhbGFybVR5cGUgPT0gMyB8fCBhbGFybVR5cGUgPT0gNCkgewogICAgICAgICAgICByZXR1cm4gZ2V0U2xvcGVWYWx1ZShjaGFubmVsVmFsdWUsIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9TVEFSVCwgREVWSUNFX1RFTVBFUkFUVVJFX1JBTkdFX0VORCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gZ2V0VGhyZXNob2xkVmFsdWUoY2hhbm5lbFZhbHVlLCBERVZJQ0VfVEVNUEVSQVRVUkVfUkFOR0VfU1RBUlQsIERFVklDRV9URU1QRVJBVFVSRV9SQU5HRV9FTkQpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gRVJST1JfVkFMVUU7Cn0KCi8qKgogKiBSZXR1cm5zIHRoZSByZWFsIHRocmVzaG9sZCB2YWx1ZSBvZiBwcmVzc3VyZSBiYXNlZCBvbiBtZWFzdXJlbWVudCByYW5nZSAobWVhc3VyZW5kKQogKiBAcGFyYW0ge051bWJlcn0gY2hhbm5lbFZhbHVlICAKICogQHBhcmFtICB7TnVtYmVyfSBtZWFzdXJlbWVudFJhbmdlU3RhcnQgICByYW5nZSBzdGFydAogKiBAcGFyYW0gIHtOdW1iZXJ9IG1lYXN1cmVtZW50UmFuZ2VFbmQgICAgIHJhbmdlIGVuZAogKiBAYWNjZXNzIHByaXZhdGUKICovCmZ1bmN0aW9uIGdldFRocmVzaG9sZFZhbHVlKGNoYW5uZWxWYWx1ZSwgbWVhc3VyZW1lbnRSYW5nZVN0YXJ0LCBtZWFzdXJlbWVudFJhbmdlRW5kKSB7CiAgICByZXR1cm4gZ2V0Q2FsY3VsYXRlZFZhbHVlKGNoYW5uZWxWYWx1ZSwgbWVhc3VyZW1lbnRSYW5nZVN0YXJ0LCBtZWFzdXJlbWVudFJhbmdlRW5kLCAyNTAwLCAxMjUwMCk7Cn0KCi8qKgogKiBSZXR1cm5zIHRoZSByZWFsIHBoeXNpY2FsIHZhbHVlIG9mIHByZXNzdXJlIGJhc2VkIG9uIG1lYXN1cmVtZW50IHJhbmdlIChtZWFzdXJlbmQvbWludXRlKQogKiBAcGFyYW0ge051bWJlcn0gY2hhbm5lbFZhbHVlICAKICogQHBhcmFtICB7TnVtYmVyfSBtZWFzdXJlbWVudFJhbmdlU3RhcnQgICByYW5nZSBzdGFydAogKiBAcGFyYW0gIHtOdW1iZXJ9IG1lYXN1cmVtZW50UmFuZ2VFbmQgICAgIHJhbmdlIGVuZAogKiBAYWNjZXNzIHByaXZhdGUKICovCmZ1bmN0aW9uIGdldFNsb3BlVmFsdWUoY2hhbm5lbFZhbHVlLCBtZWFzdXJlbWVudFJhbmdlU3RhcnQsIG1lYXN1cmVtZW50UmFuZ2VFbmQpIHsKICAgIHJldHVybiBnZXRDYWxjdWxhdGVkVmFsdWUoY2hhbm5lbFZhbHVlLCBtZWFzdXJlbWVudFJhbmdlU3RhcnQsIG1lYXN1cmVtZW50UmFuZ2VFbmQsIDAsIDEwMDAwKTsKfQoKLyoqCiAqIFRvIGNvbnZlcnQgYSBoZXggZW5jb2RlZCBzdHJpbmcgdG8gYSBpbnRlZ2VyIGFycmF5CiAqIEBwYXJhbSB7c3RyaW5nfSBoZXhFbmNvZGVkU3RyaW5nCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKi8KZnVuY3Rpb24gY29udmVydEhleFN0cmluZ1RvQnl0ZXMoaGV4RW5jb2RlZFN0cmluZykgewogICAgaWYgKGhleEVuY29kZWRTdHJpbmcuc3RhcnRzV2l0aCgiMHgiKSkgewogICAgICAgIGhleEVuY29kZWRTdHJpbmcgPSBoZXhFbmNvZGVkU3RyaW5nLnNsaWNlKDIpOwogICAgfQoKICAgIC8vIHJlbW92ZSBzcGFjZXMKICAgIGhleEVuY29kZWRTdHJpbmcgPSBoZXhFbmNvZGVkU3RyaW5nLnJlcGxhY2UoL1xzL2csICcnKTsKCiAgICB2YXIgYnl0ZXMgPSBbXTsKCiAgICAvLyBjb252ZXJ0IGJ5dGUgdG8gYnl0ZSAoMiBjaGFyYWN0ZXJzIGFyZSAxIGJ5dGUpCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhleEVuY29kZWRTdHJpbmcubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICAvLyBleHRyYWN0IDIgY2hhcmFjdGVycwogICAgICAgIHZhciBoZXggPSBoZXhFbmNvZGVkU3RyaW5nLnN1YnN0cihpLCAyKTsKCiAgICAgICAgLy8gY29udmVydCBoZXggcGFpciB0byBpbnRlZ2VyCiAgICAgICAgdmFyIGludFZhbHVlID0gcGFyc2VJbnQoaGV4LCAxNik7CgogICAgICAgIGJ5dGVzLnB1c2goaW50VmFsdWUpOwogICAgfQoKICAgIHJldHVybiBieXRlczsKfQoKLyoqCiAqIFRvIGNvbnZlcnQgYSBiYXNlNjQgZW5jb2RlZCBzdHJpbmcgdG8gYSBpbnRlZ2VyIGFycmF5CiAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjRFbmNvZGVkU3RyaW5nCiAqIEBhY2Nlc3MgcHJpdmF0ZQogKi8KZnVuY3Rpb24gY29udmVydEJhc2U2NFN0cmluZ1RvQnl0ZXMoYmFzZTY0RW5jb2RlZFN0cmluZykgewogICAgdmFyIGJ5dGVzID0gW107CgogICAgLy8gY29udmVydCBiYXNlNjQgdG8gc3RyaW5nCiAgICB2YXIgZGVjb2RlZEJ5dGVzID0gQnVmZmVyLmZyb20oYmFzZTY0RW5jb2RlZFN0cmluZywgJ2Jhc2U2NCcpCgogICAgLy8gY29udmVydCBieXRlIHRvIGJ5dGUgKDIgY2hhcmFjdGVycyBhcmUgMSBieXRlKQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWNvZGVkQnl0ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBjb252ZXJ0IGJ5dGUgdG8gaW50ZWdlcgogICAgICAgIHZhciBpbnRWYWx1ZSA9IGRlY29kZWRCeXRlc1tpXTsKCiAgICAgICAgYnl0ZXMucHVzaChpbnRWYWx1ZSk7CiAgICB9CgogICAgcmV0dXJuIGJ5dGVzOwp9CgovKioKICogUmV0dXJucyB0aGUgcHJpbnRhYmxlIG5hbWUgb2YgYSBtZWFzdXJhbmQgZm9yIGEgTFBQIHN1cHBvcnRpbmcgZGV2aWNlcyBlLmcuOiAxID0gIlRlbXBlcmF0dXJlIgogKiBAYWNjZXNzIHByaXZhdGUKICogQHBhcmFtICB7TnVtYmVyfSBpZCAgICBJZGVudGlmaWVyIGFzIGludGVnZXIgCiAqIEByZXR1cm4ge3N0cmluZ30gICAgICAgUmV0dXJucyB0aGUgcHJpbnRhYmxlIG5hbWUgb2YgYSBwaHlzaWNhbCB1bml0IFBHVzIzLjEwMC4xMSBlLmcuOiAxID0gIm1CYXIiCiAqLwpmdW5jdGlvbiByZXR1cm5QaHlzaWNhbFVuaXRGcm9tSWQoaWQpIHsKICAgIHN3aXRjaCAoaWQpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHJldHVybiAiaW5IMk8iOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcmV0dXJuICJpbkhnIjsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiAiZnRIMk8iOwogICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgcmV0dXJuICJtbUgyTyI7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgICByZXR1cm4gIm1tSGciOwogICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgcmV0dXJuICJwc2kiOwogICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgcmV0dXJuICJiYXIiOwogICAgICAgIGNhc2UgODoKICAgICAgICAgICAgcmV0dXJuICJtYmFyIjsKICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIHJldHVybiAiZy9jbcKyIjsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICByZXR1cm4gImtnL2NtwrIiOwogICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgIHJldHVybiAiUGEiOwogICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgIHJldHVybiAia1BhIjsKICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICByZXR1cm4gIlRvcnIiOwogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIHJldHVybiAiYXQiOwogICAgICAgIGNhc2UgMTQ1OgogICAgICAgICAgICByZXR1cm4gImluSDJPICg2MCDCsEYpIjsKICAgICAgICBjYXNlIDE3MDoKICAgICAgICAgICAgcmV0dXJuICJjbUgyTyAoNCDCsEMpIjsKICAgICAgICBjYXNlIDE3MToKICAgICAgICAgICAgcmV0dXJuICJtSDJPICg0IMKwQykiOwogICAgICAgIGNhc2UgMTcyOgogICAgICAgICAgICByZXR1cm4gImNtSGciOwogICAgICAgIGNhc2UgMTczOgogICAgICAgICAgICByZXR1cm4gImxiL2Z0wrIiOwogICAgICAgIGNhc2UgMTc0OgogICAgICAgICAgICByZXR1cm4gImhQYSI7CiAgICAgICAgY2FzZSAxNzU6CiAgICAgICAgICAgIHJldHVybiAicHNpYSI7CiAgICAgICAgY2FzZSAxNzY6CiAgICAgICAgICAgIHJldHVybiAia2cvbcKyIjsKICAgICAgICBjYXNlIDE3NzoKICAgICAgICAgICAgcmV0dXJuICJmdEgyTyAoNCDCsEMpIjsKICAgICAgICBjYXNlIDE3ODoKICAgICAgICAgICAgcmV0dXJuICJmdEgyTyAoNjAgwrBGKSI7CiAgICAgICAgY2FzZSAxNzk6CiAgICAgICAgICAgIHJldHVybiAibUhnIjsKICAgICAgICBjYXNlIDE4MDoKICAgICAgICAgICAgcmV0dXJuICJNcHNpIjsKICAgICAgICBjYXNlIDIzNzoKICAgICAgICAgICAgcmV0dXJuICJNUGEiOwogICAgICAgIGNhc2UgMjM4OgogICAgICAgICAgICByZXR1cm4gImluSDJPICg0IMKwQykiOwogICAgICAgIGNhc2UgMjM5OgogICAgICAgICAgICByZXR1cm4gIm1tSDJPICg0IMKwQykiOwogICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgIHJldHVybiAiwrBDIjsKICAgICAgICBjYXNlIDMzOgogICAgICAgICAgICByZXR1cm4gIsKwRiI7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuICJVbmtub3duIjsKICAgIH0KfQoKLy8gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKLy8gICAgICAgICAgRXhwb3J0IGZ1bmN0aW9ucyBTZWN0aW9uCi8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqCmlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIGV4cG9ydHMuZGVjb2RlVXBsaW5rID0gZGVjb2RlVXBsaW5rOwogICAgZXhwb3J0cy5zZXRNZWFzdXJlbWVudFJhbmdlcyA9IHNldE1lYXN1cmVtZW50UmFuZ2VzOwogICAgZXhwb3J0cy5kZWNvZGVIZXhTdHJpbmcgPSBkZWNvZGVIZXhTdHJpbmc7CiAgICBleHBvcnRzLmRlY29kZUJhc2U2NFN0cmluZyA9IGRlY29kZUJhc2U2NFN0cmluZzsKfQoKCgpmdW5jdGlvbiBleHRyYWN0RnJvbVNvdXJjZShjdHgpIHsKICAgIC8vVGhpcyBpcyB0aGUgc291cmNlIG1lc3NhZ2UgYXMganNvbgogICAgY29uc3Qgc291cmNlT2JqZWN0ID0gY3R4LmdldEpzb25PYmplY3QoKTsKCiAgICBjb25zdCBpbnB1dCA9IHNvdXJjZU9iamVjdDsKICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2VPYmplY3QpIHsKICAgICAgICAgY29uc29sZS5sb2coYGtleTogJHtrZXl9LCB2YWx1ZTogJHtzb3VyY2VPYmplY3QuZ2V0KGtleSl9YCk7ICAKICAgIH0KICAgIAogICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZShpbnB1dCk7CgogICAgY29uc29sZS5sb2coIk91dHB1dDoiICsgSlNPTi5zdHJpbmdpZnkoZGVjb2RlZCkpOwogICAgY29uc3QgIG1lYXN1cmVtZW50cyA9IGRlY29kZWQuZGF0YS5tZWFzdXJlbWVudC5jaGFubmVsczsKCgogICAgLy9EZWZpbmUgYSBuZXcgTWVhc3VyZW1lbnQgVmFsdWUgZm9yIHByZXNzdXJlIGJ5IGFzc2lnbmluZyBmcm9tIHNvdXJjZQogICAgY29uc3QgZnJhZ21lbnRQcmVzc3VyZVNlcmllcyA9IHsKICAgICAgICB2YWx1ZTogbWVhc3VyZW1lbnRzWzBdLnZhbHVlLAogICAgICAgIHVuaXQ6ICdiYXInCiAgICB9OwoKICAgIGNvbnN0IGZyYWdtZW50UHJlc3N1cmUgPSB7CiAgICAgICAgcDogZnJhZ21lbnRQcmVzc3VyZVNlcmllcwogICAgfTsgCgogICAgLy8gQ3JlYXRlIGEgbmV3IFN1YnN0aXR1dGlvblJlc3VsdCB3aXRoIHRoZSBIYXNoTWFwCiAgICBjb25zdCByZXN1bHQgPSBuZXcgU3Vic3RpdHV0aW9uUmVzdWx0KCk7CgogICAgY29uc3QgZnJhZ21lbnRQcmVzc3VyZVNWID0gbmV3IFN1YnN0aXR1dGlvblZhbHVlKGZyYWdtZW50UHJlc3N1cmUsIFRZUEUuT0JKRUNULCBSZXBhaXJTdHJhdGVneS5DUkVBVEVfSUZfTUlTU0lORywgZmFsc2UpOwogICAgYWRkVG9TdWJzdGl0dXRpb25zTWFwKHJlc3VsdCwgJ2M4eV9QcmVzc3VyZScsIGZyYWdtZW50UHJlc3N1cmVTVik7CgogICAgY29uc3QgdHlwZVNWID0gbmV3IFN1YnN0aXR1dGlvblZhbHVlKCJjOHlfUHJlc3N1cmVNZWFzdXJlbWVudCIsIFRZUEUuVEVYVCwgUmVwYWlyU3RyYXRlZ3kuQ1JFQVRFX0lGX01JU1NJTkcsIGZhbHNlKTsKICAgIGFkZFRvU3Vic3RpdHV0aW9uc01hcChyZXN1bHQsICd0eXBlJywgdHlwZVNWKTsKCiAgICBjb25zdCBzb3VyY2UgPSB7CiAgICAgICAgaWQ6IGN0eC5nZXRDOFlJZGVudGlmaWVyKCkKICAgIH07CiAgICBjb25zdCBzb3VyY2VGcmFnbWVudFNWID0gbmV3IFN1YnN0aXR1dGlvblZhbHVlKHNvdXJjZSwgVFlQRS5PQkpFQ1QsIFJlcGFpclN0cmF0ZWd5LkNSRUFURV9JRl9NSVNTSU5HLCBmYWxzZSk7CiAgICBhZGRUb1N1YnN0aXR1dGlvbnNNYXAocmVzdWx0LCAnc291cmNlJywgc291cmNlRnJhZ21lbnRTVik7CgogICAgLy9TZXQgdGltZSBtYXBwaW5nIHRpbWUgLT4gdGltZQogICAgY29uc3QgdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICAgIGNvbnN0IHRpbWVTViA9IG5ldyBTdWJzdGl0dXRpb25WYWx1ZSh0aW1lLCBUWVBFLlRFWFRVQUwsIFJlcGFpclN0cmF0ZWd5LkNSRUFURV9JRl9NSVNTSU5HLCBmYWxzZSk7CiAgICBhZGRUb1N1YnN0aXR1dGlvbnNNYXAocmVzdWx0LCAndGltZScsIHRpbWVTVik7CgogICAgcmV0dXJuIHJlc3VsdDsKfQ==",
    "lastUpdate": 1743531196281
  }
]