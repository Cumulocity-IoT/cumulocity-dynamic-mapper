<c8y-title translate>MQTT</c8y-title>

<c8y-action-bar-item [placement]="'right'">
  <button class="btn btn-link" title="{{ 'Add mapping' | translate }}" (click)="addMapping()">
    <i c8yIcon="plus-circle"></i>
    {{ 'Add mapping' | translate }}
  </button>

  <button class="btn btn-link" title="{{ 'Save changes' | translate }}" (click)="onSaveButtonClicked()">
    <i c8yIcon="save"></i>
    {{ 'Save changes' | translate }}
  </button>
</c8y-action-bar-item>
<div class="card w-75">
  <div class="col-xs-12 col-sm-10 col-md-8 col-lg-12 bg-white">
    <div class="card-header separator j-c-between">
      <p class="card-title" translate>Mapping</p>
    </div>
    <div class="card-block">
      <c8y-data-grid [title]="'Mapping List' | translate" [columns]="columns" [rows]="mqttMappings"
        [pagination]="pagination" [actionControls]="actionControls" [displayOptions]="displayOptions">
      </c8y-data-grid>
    </div>
    <div class="card-block">
      <div class="card-header separator j-c-between" style=" margin-bottom: 30px;">
        <h4 style="font-weight:300 !important;" translate>Edit Mapping</h4>
      </div>
      <div [formGroup]="mappingForm" class="form-horizontal">
        <div class="form-group">
          <label for="id" class="col-sm-2" translate>Id</label>
          <div class="col-sm-4">
            <input formControlName="id" type="text" class="form-control" #idRef required readonly />
          </div>
        </div>
        <div class="form-group">
          <label for="topic" class="col-sm-2" translate>Topic</label>
          <div class="col-sm-4">
            <input formControlName="topic" type="text" class="form-control" placeholder="e.g. /device/110" #idRef
            required />
          </div>
        </div>
        <div class="form-group">
          <label for="targetAPI" class="col-sm-2" translate>Target API</label>
          <div class="col-sm-4">
          <select class="form-control" formControlName="targetAPI" #targetAPIRef>
            <option *ngFor="let api of APIs" [ngValue]="api">
              {{ api }}
            </option>
          </select>
          </div>
        </div>
        <div class="form-group">
          <label for="qos" class="col-sm-2" translate>QOS</label>
          <div class="col-sm-4">
          <select class="form-control" formControlName="qos" #qosRef>
            <option *ngFor="let q of QOSs" [ngValue]="q.value">
              {{ q.name }}
            </option>
          </select>
          </div>
        </div>
        <div class="form-group">
          <label for="active" class="col-sm-2" translate>Mapping Active</label>
          <div class="col-sm-4">
          <input formControlName="active" type="checkbox" class="form-control" #activeRef />
          </div>
        </div>
        <div class="row">
          <div class="col-lg-6" style="height:300px">
            <ngx-monaco-editor formControlName="source" [options]="editorOptions" [(ngModel)]="mappingForm.source">
            </ngx-monaco-editor>
          </div>
          <div class="col-lg-6" style="height:300px">
            <ngx-monaco-editor formControlName="target" [options]="editorOptions" [(ngModel)]="mappingForm.target">
            </ngx-monaco-editor>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="form-group">
    <button type="button" name="save" class="btn btn-primary" (click)="onCommitButtonClicked()" translate>
      Commit changes
    </button>
    <button type="button" name="format" class="btn btn-primary" (click)="onFormatButtonClicked()" translate>
      Format Templates
    </button>
  </div>
</div>