<!--
~ Copyright (c) 2022-2025 Cumulocity GmbH.
~
~ SPDX-License-Identifier: Apache-2.0
~
~  Licensed under the Apache License, Version 2.0 (the "License");
~  you may not use this file except in compliance with the License.
~  You may obtain a copy of the License at
~
~       http://www.apache.org/licenses/LICENSE-2.0
~
~  Unless required by applicable law or agreed to in writing, software
~  distributed under the License is distributed on an "AS IS" BASIS,
~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~  See the License for the specific language governing permissions and
~  limitations under the License.
~
~  @authors Christof Strack, Stefan Witschel
~
-->

<div class="flex-col flex-nowrap no-align-items p-48 flex-grow col-md-12 col-md-offset-0">
  <div class="card">
    <div class="card-header separator" style="justify-content: center">
      <h4 class="card-title d-flex">
        <span class="ai-icon-wrap m-r-8">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="32" height="32">
            <path
              d="M9.03243 5.98167C9.1394 5.68167 9.54825 5.68167 9.65521 5.98167L11.4431 10.9961C11.4767 11.0904 11.5483 11.1648 11.6392 11.1997L16.4708 13.0552C16.7599 13.1662 16.7599 13.5905 16.4708 13.7015L11.6392 15.557C11.5483 15.5919 11.4767 15.6663 11.4431 15.7606L9.65521 20.775C9.54825 21.075 9.1394 21.075 9.03243 20.775L7.24458 15.7606C7.21095 15.6663 7.13929 15.5919 7.04841 15.557L2.2168 13.7015C1.92773 13.5905 1.92773 13.1662 2.2168 13.0552L7.04841 11.1997C7.13929 11.1648 7.21095 11.0904 7.24458 10.9961L9.03243 5.98167Z"
              fill="currentColor" />
            <path
              d="M18.3291 3.225C18.436 2.925 18.8449 2.925 18.9518 3.225L19.6636 5.22123C19.6972 5.31555 19.7689 5.38992 19.8597 5.42482L21.7832 6.16349C22.0723 6.2745 22.0723 6.69882 21.7832 6.80983L19.8597 7.5485C19.7689 7.5834 19.6972 7.65776 19.6636 7.75208L18.9518 9.74831C18.8449 10.0483 18.436 10.0483 18.3291 9.74831L17.6173 7.75208C17.5837 7.65776 17.512 7.5834 17.4211 7.5485L15.4977 6.80983C15.2086 6.69882 15.2086 6.2745 15.4977 6.16349L17.4211 5.42482C17.512 5.38992 17.5837 5.31555 17.6173 5.22123L18.3291 3.225Z"
              fill="currentColor" />
            <path
              d="M17.001 15.63C17.1079 15.33 17.5168 15.33 17.6237 15.63L17.9768 16.6202C18.0104 16.7145 18.0821 16.7889 18.1729 16.8238L19.127 17.1902C19.4161 17.3012 19.4161 17.7255 19.127 17.8365L18.1729 18.2029C18.0821 18.2378 18.0104 18.3122 17.9768 18.4065L17.6237 19.3967C17.5168 19.6967 17.1079 19.6967 17.001 19.3967L16.6479 18.4065C16.6143 18.3122 16.5426 18.2378 16.4518 18.2029L15.4977 17.8365C15.2086 17.7255 15.2086 17.3012 15.4977 17.1902L16.4518 16.8238C16.5426 16.7889 16.6143 16.7145 16.6479 16.6202L17.001 15.63Z"
              fill="currentColor" />
          </svg>
        </span>
        <span class="m-t-8">Generate substitutions with agent:</span>
        <span class="label label-primary m-l-8 m-t-8 m-b-8 text-16">{{aiAgent.name}}</span>
      </h4>
    </div>

    <div class="card-inner-scroll flex-grow" style="min-height: 0;">
      <div class="card-block p-0">
        @if (aiAgent) {
        <c8y-ai-chat [isLoading]="isLoadingChat" [disabled]="false" [prompt]="newMessage"
          (onMessage)="handleMessage($event)" [config]="chatConfig">
          @for (message of getCompatibleMessages(); track message) {
          <c8y-ai-chat-message [message]="formatMessage(message)">
          </c8y-ai-chat-message>
          }
        </c8y-ai-chat>
        }
      </div>
    </div>
    <div class="card-footer text-center sticky-buttons">
      <div class="form-group">
        <button type="button" name="update" class="btn btn-primary" (click)="save()" [disabled]="!valid" translate>
          Save
        </button>
        <button type="button" name="update" class="btn btn-primary" (click)="cancel()" translate>
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>